<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫•u h√¨nh h·ªá th·ªëng - AIoT Weather</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <script src="/static/js/i18n.js"></script>
    <style>
        /* ===== Custom Settings Styles ===== */

        /* Banner */
        .settings-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            color: white;
            padding: 50px;
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
            position: relative;
            overflow: hidden;
        }

        .settings-banner h2 {
            font-size: 32px;
            font-weight: 800;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        .settings-banner p {
            font-size: 16px;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Settings Container */
        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 40px;
        }

        .settings-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .settings-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15);
            border-color: var(--primary-color);
        }

        .settings-card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .settings-card-icon {
            font-size: 32px;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .settings-card-title {
            font-size: 18px;
            font-weight: 800;
            color: var(--text);
            letter-spacing: -0.5px;
        }

        .settings-card-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
            margin-top: 3px;
        }

        /* Form Group */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group:last-child {
            margin-bottom: 0;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
            letter-spacing: 0.2px;
        }

        .form-label-note {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 400;
            margin-top: 4px;
        }

        .form-control {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            background: var(--bg);
            color: var(--text);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            background: var(--card-bg);
            transform: translateY(-1px);
        }

        .form-control::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .form-row.full {
            grid-template-columns: 1fr;
        }

        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: rgba(72, 187, 120, 0.1);
            color: #48bb78;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-badge.error {
            background: rgba(245, 101, 101, 0.1);
            color: #f56565;
        }

        .status-badge.warning {
            background: rgba(237, 137, 54, 0.1);
            color: #ed8936;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: currentColor;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Buttons */
        .btn-container {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .btn-save {
            flex: 1;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.35);
            min-width: 150px;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(102, 126, 234, 0.45);
        }

        .btn-save:active {
            transform: translateY(0);
        }

        .btn-secondary {
            padding: 12px 24px;
            background: var(--card-bg);
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 150px;
        }

        .btn-secondary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        /* Divider */
        .settings-divider {
            grid-column: 1 / -1;
            height: 1px;
            background: var(--border-color);
            margin: 10px 0;
        }

        /* Value Display */
        .value-display {
            background: var(--bg);
            padding: 12px 14px;
            border-radius: 10px;
            border: 1px solid var(--border-color);
            font-size: 14px;
            color: var(--text);
            font-weight: 600;
        }

        /* Switch */
        .switch {
            display: inline-block;
            position: relative;
            width: 50px;
            height: 28px;
            margin: 5px 0;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: 0.3s;
            border-radius: 28px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(22px);
        }

        /* Info Box */
        .info-box {
            background: rgba(66, 153, 225, 0.1);
            border-left: 4px solid #4299e1;
            padding: 12px 14px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--text);
            margin-bottom: 15px;
        }

        .info-box.warning {
            background: rgba(237, 137, 54, 0.1);
            border-left-color: #ed8936;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .settings-banner {
                padding: 35px 25px;
            }

            .settings-banner h2 {
                font-size: 26px;
            }

            .settings-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .btn-container {
                flex-direction: column;
            }

            .btn-save, .btn-secondary {
                width: 100%;
            }
        }

        /* System Control Styles */
        .system-control-group {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        .control-item {
            padding: 18px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .control-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .control-label {
            font-size: 15px;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 6px;
        }

        .control-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin: 0 0 12px 0;
            line-height: 1.4;
        }

        .control-divider {
            display: none;
        }

        .btn-control {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
        }

        .btn-control.danger {
            background: linear-gradient(135deg, #f56565, #e53e3e);
            color: white;
            box-shadow: 0 4px 12px rgba(245, 101, 101, 0.3);
        }

        .btn-control.danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(245, 101, 101, 0.4);
        }

        .btn-control.warning {
            background: linear-gradient(135deg, #ed8936, #dd6b20);
            color: white;
            box-shadow: 0 4px 12px rgba(237, 137, 54, 0.3);
        }

        .btn-control.warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(237, 137, 54, 0.4);
        }

        .btn-control.info {
            background: linear-gradient(135deg, #4299e1, #2b70b6);
            color: white;
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
        }

        .btn-control.info:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(66, 153, 225, 0.4);
        }

        /* System Stats Display */
        .system-stat-item {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .system-stat-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .stat-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            font-size: 14px;
            color: var(--text);
            margin-bottom: 8px;
        }

        .stat-icon {
            font-size: 18px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .stat-value.temp-danger {
            color: #f56565;
        }

        .stat-value.temp-warning {
            color: #ed8936;
        }

        .stat-value.temp-good {
            color: #48bb78;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease-in-out;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }

        .progress-fill.cpu-progress {
            background: linear-gradient(90deg, #4299e1, #2b70b6);
        }

        .progress-fill.ram-progress {
            background: linear-gradient(90deg, #48bb78, #38a169);
        }

        .progress-fill.gpu-progress {
            background: linear-gradient(90deg, #ed64a6, #d53f8c);
        }

        .progress-fill.temp-progress {
            background: linear-gradient(90deg, #48bb78, #ed8936, #f56565);
        }

        .progress-fill.storage-progress {
            background: linear-gradient(90deg, #9f7aea, #6b46c1);
        }

        .stat-detail {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .temp-status-good {
            color: #48bb78;
            font-weight: 700;
        }

        .temp-status-warning {
            color: #ed8936;
            font-weight: 700;
        }

        .temp-status-danger {
            color: #f56565;
            font-weight: 700;
        }

        .btn-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-container .btn-save {
            flex: 1;
        }
    </style>
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">
                <span class="logo-icon">üå§Ô∏è</span>
                <div>
                    <div class="app-title">AIoT Weather</div>
                    <div class="app-subtitle">AIoT-ML</div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/" class="nav-link">
                        <span class="nav-icon">üè†</span>
                        <span data-i18n="nav.overview">T·ªïng quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/charts" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span data-i18n="nav.charts">Bi·ªÉu ƒë·ªì & Ph√¢n t√≠ch</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/forecast" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span data-i18n="nav.forecast">D·ª± b√°o (ML)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/ml-training" class="nav-link">
                        <span class="nav-icon">üöÄ</span>
                        <span data-i18n="nav.mlTraining">Hu·∫•n luy·ªán ML</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/mysql" class="nav-link">
                        <span class="nav-icon">üíæ</span>
                        <span data-i18n="nav.mysql">Qu·∫£n l√Ω d·ªØ li·ªáu</span>
                    </a>
                </li>
                <li class="nav-item active">
                    <a href="/settings" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span data-i18n="nav.settings">C·∫•u h√¨nh</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
                <h1 class="page-title">‚öôÔ∏è <span data-i18n="settings.pageTitle">C·∫•u h√¨nh h·ªá th·ªëng</span></h1>
            </div>
            <div class="topbar-right">
                <div class="clock-display">
                    <span class="clock-time" id="clockTime">00:00:00</span>
                    <span class="clock-label">GMT+7</span>
                </div>
                <!-- Language Switcher -->
                <button class="lang-toggle-btn" id="langToggleBtn" onclick="toggleLanguage()" title="Switch Language">
                    <span class="lang-flag-toggle" id="langFlagVi">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 30 20" width="24" height="16">
                            <rect width="30" height="20" fill="#da251d"/>
                            <polygon points="15,4 11.47,14.85 20.71,8.15 9.29,8.15 18.53,14.85" fill="#ff0"/>
                        </svg>
                    </span>
                    <span class="lang-separator">|</span>
                    <span class="lang-flag-toggle" id="langFlagEn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="24" height="16">
                            <clipPath id="s"><path d="M0,0 v30 h60 v-30 z"/></clipPath>
                            <clipPath id="t"><path d="M30,15 h30 v15 z v15 h-30 z h-30 v-15 z v-15 h30 z"/></clipPath>
                            <g clip-path="url(#s)"><path d="M0,0 v30 h60 v-30 z" fill="#012169"/>
                            <path d="M0,0 L60,30 M60,0 L0,30" stroke="#fff" stroke-width="6"/>
                            <path d="M0,0 L60,30 M60,0 L0,30" clip-path="url(#t)" stroke="#C8102E" stroke-width="4"/>
                            <path d="M30,0 v30 M0,15 h60" stroke="#fff" stroke-width="10"/>
                            <path d="M30,0 v30 M0,15 h60" stroke="#C8102E" stroke-width="6"/></g>
                        </svg>
                    </span>
                </button>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- Banner -->
            <section class="section">
                <div class="settings-banner">
                    <h2>‚öôÔ∏è <span data-i18n="settingsExt.bannerTitle">C·∫•u h√¨nh h·ªá th·ªëng AIoT</span></h2>
                    <p data-i18n="settingsExt.bannerDesc">Qu·∫£n l√Ω thi·∫øt b·ªã, k·∫øt n·ªëi, v·ªã tr√≠, v√† c√°c tham s·ªë h·ªá th·ªëng</p>
                </div>
            </section>

            <!-- Settings Cards -->
            <section class="section">
                <div class="settings-container">
                    <!-- Th√¥ng s·ªë thi·∫øt b·ªã -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-icon">üñ•Ô∏è</div>
                            <div>
                                <div class="settings-card-title" data-i18n="settingsExt.rpiStats">Th√¥ng s·ªë Raspberry Pi</div>
                                <div class="settings-card-subtitle" data-i18n="settingsExt.rpiSubtitle">RAM, CPU, GPU & Nhi·ªát ƒë·ªô</div>
                            </div>
                        </div>

                        <!-- CPU -->
                        <div class="system-stat-item">
                            <div class="stat-label">
                                <span class="stat-icon">‚öôÔ∏è</span>
                                <span data-i18n="settingsExt.cpuUsage">CPU Usage</span>
                            </div>
                            <div class="stat-value" id="cpuUsage">--</div>
                            <div class="progress-bar">
                                <div class="progress-fill cpu-progress" id="cpuProgressBar"></div>
                            </div>
                            <div class="stat-detail">
                                <span data-i18n="settingsExt.cores">Cores</span>: <span id="cpuCores">--</span> | 
                                <span data-i18n="settingsExt.freq">Freq</span>: <span id="cpuFreq">--</span> MHz
                            </div>
                        </div>

                        <!-- RAM -->
                        <div class="system-stat-item">
                            <div class="stat-label">
                                <span class="stat-icon">üíæ</span>
                                <span data-i18n="settingsExt.memory">Memory (RAM)</span>
                            </div>
                            <div class="stat-value" id="ramUsage">--</div>
                            <div class="progress-bar">
                                <div class="progress-fill ram-progress" id="ramProgressBar"></div>
                            </div>
                            <div class="stat-detail">
                                <span data-i18n="settingsExt.used">Used</span>: <span id="ramUsed">--</span> MB | 
                                <span data-i18n="settingsExt.total">Total</span>: <span id="ramTotal">--</span> MB
                            </div>
                        </div>

                        <!-- GPU -->
                        <div class="system-stat-item">
                            <div class="stat-label">
                                <span class="stat-icon">üéÆ</span>
                                <span data-i18n="settingsExt.gpuMemory">GPU Memory</span>
                            </div>
                            <div class="stat-value" id="gpuMem">--</div>
                            <div class="progress-bar">
                                <div class="progress-fill gpu-progress" id="gpuProgressBar"></div>
                            </div>
                            <div class="stat-detail">
                                <span data-i18n="settingsExt.allocated">Allocated</span>: <span id="gpuAllocated">--</span> MB
                            </div>
                        </div>

                        <!-- Temperature -->
                        <div class="system-stat-item">
                            <div class="stat-label">
                                <span class="stat-icon">üå°Ô∏è</span>
                                <span data-i18n="settingsExt.cpuTemp">CPU Temperature</span>
                            </div>
                            <div class="stat-value temp-danger" id="cpuTemp">-- ¬∞C</div>
                            <div class="progress-bar">
                                <div class="progress-fill temp-progress" id="tempProgressBar"></div>
                            </div>
                            <div class="stat-detail">
                                <span data-i18n="settingsExt.tempStatus">Status</span>: <span id="tempStatus" class="temp-status-good">‚úì <span data-i18n="settingsExt.tempGood">Normal</span></span>
                            </div>
                        </div>

                        <!-- Storage -->
                        <div class="system-stat-item">
                            <div class="stat-label">
                                <span class="stat-icon">üíø</span>
                                <span data-i18n="settingsExt.storage">Storage</span>
                            </div>
                            <div class="stat-value" id="storageUsage">--</div>
                            <div class="progress-bar">
                                <div class="progress-fill storage-progress" id="storageProgressBar"></div>
                            </div>
                            <div class="stat-detail">
                                <span data-i18n="settingsExt.used">Used</span>: <span id="storageUsed">--</span> GB | 
                                <span data-i18n="settingsExt.total">Total</span>: <span id="storageTotal">--</span> GB
                            </div>
                        </div>

                        <!-- Uptime -->
                        <div class="system-stat-item">
                            <div class="stat-label">
                                <span class="stat-icon">‚è±Ô∏è</span>
                                <span data-i18n="settingsExt.uptime">System Uptime</span>
                            </div>
                            <div class="stat-value" id="uptimeValue">-- h</div>
                            <div class="stat-detail">
                                <span data-i18n="settingsExt.bootTime">Boot time</span>: <span id="bootTime">--</span>
                            </div>
                        </div>

                        <button class="btn-save" onclick="refreshSystemStats()" style="margin-top: 20px;">üîÑ <span data-i18n="common.refresh">L√†m m·ªõi</span></button>
                    </div>

                    <!-- C·∫•u h√¨nh v·ªã tr√≠ -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-icon">üìç</div>
                            <div>
                                <div class="settings-card-title" data-i18n="settingsExt.locationConfig">C·∫•u h√¨nh v·ªã tr√≠</div>
                                <div class="settings-card-subtitle" data-i18n="settingsExt.locationSubtitle">T·ªça ƒë·ªô GPS & ƒê·ªãa ch·ªâ</div>
                            </div>
                        </div>

                        <div class="info-box">
                            üìå <span data-i18n="settingsExt.locationHint">Nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm v√† l·∫•y t·ªça ƒë·ªô t·ª± ƒë·ªông</span>
                        </div>

                        <!-- B∆∞·ªõc 1: T√¨m ki·∫øm v·ªã tr√≠ -->
                        <div style="margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                            <label class="form-label" style="margin-bottom: 12px;">üîç <span data-i18n="settingsExt.step1">B∆∞·ªõc 1: T√¨m ki·∫øm v·ªã tr√≠</span></label>
                            
                            <!-- T√πy ch·ªçn: S·ª≠ d·ª•ng v·ªã tr√≠ hi·ªán t·∫°i -->
                            <div style="margin-bottom: 15px;">
                                <button class="btn-secondary" type="button" onclick="useCurrentLocation()" style="width: 100%; white-space: nowrap;">
                                    üìç <span data-i18n="settingsExt.useCurrentLocation">S·ª≠ d·ª•ng v·ªã tr√≠ hi·ªán t·∫°i (GPS)</span>
                                </button>
                            </div>

                            <!-- Ho·∫∑c t√¨m ki·∫øm theo t√™n -->
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                                <span style="font-size: 13px; color: var(--text-secondary); font-weight: 600;" data-i18n="settingsExt.or">HO·∫∂C</span>
                                <div style="flex: 1; height: 1px; background: var(--border-color);"></div>
                            </div>

                            <div style="display: flex; gap: 10px;">
                                <input type="text" class="form-control" id="locationName" placeholder="VD: S√†i G√≤n, H√† N·ªôi, ƒê√† N·∫µng..." data-i18n-placeholder="settingsExt.searchPlaceholder" style="flex: 1;">
                                <button class="btn-secondary" type="button" onclick="getLocationFromName()" style="white-space: nowrap; min-width: 120px;">üîç <span data-i18n="settingsExt.searchBtn">T√¨m ki·∫øm</span></button>
                            </div>
                        </div>

                        <!-- B∆∞·ªõc 2: Th√¥ng tin chi ti·∫øt -->
                        <div style="margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                            <label class="form-label" style="margin-bottom: 12px;">üìã <span data-i18n="settingsExt.step2">B∆∞·ªõc 2: Th√¥ng tin chi ti·∫øt</span></label>
                            
                            <div class="form-group">
                                <label class="form-label" data-i18n="settingsExt.fullAddress">ƒê·ªãa ch·ªâ ƒë·∫ßy ƒë·ªß</label>
                                <input type="text" class="form-control" id="locationAddress" placeholder="V√≠ d·ª•: 123 Nguy·ªÖn Hu·ªá, Q1, TP.HCM" data-i18n-placeholder="settingsExt.addressPlaceholder">
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="settingsExt.latitude">Vƒ© ƒë·ªô (Latitude)</label>
                                    <input type="number" class="form-control" id="latitude" placeholder="10.773" step="0.0001" readonly style="background: var(--bg); cursor: not-allowed; opacity: 0.8;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="settingsExt.longitude">Kinh ƒë·ªô (Longitude)</label>
                                    <input type="number" class="form-control" id="longitude" placeholder="106.700" step="0.0001" readonly style="background: var(--bg); cursor: not-allowed; opacity: 0.8;">
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="settingsExt.altitude">ƒê·ªô cao (m)</label>
                                    <input type="number" class="form-control" id="altitude" placeholder="0" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label class="form-label" data-i18n="settingsExt.timezone">M√∫i gi·ªù</label>
                                    <select class="form-control" id="timezone">
                                        <option value="Asia/Ho_Chi_Minh" selected>GMT+7 (Vi·ªát Nam)</option>
                                        <option value="Asia/Bangkok">GMT+7 (Bangkok)</option>
                                        <option value="Asia/Shanghai">GMT+8 (Shanghai)</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- B∆∞·ªõc 3: L∆∞u -->
                        <div class="btn-container">
                            <button class="btn-save" onclick="saveLocationSettings()">üíæ <span data-i18n="settingsExt.saveLocation">L∆∞u c√†i ƒë·∫∑t v·ªã tr√≠</span></button>
                        </div>
                    </div>

                    <!-- C·∫•u h√¨nh MySQL -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-icon">üíæ</div>
                            <div>
                                <div class="settings-card-title" data-i18n="settingsExt.mysqlConfig">K·∫øt n·ªëi MySQL</div>
                                <div class="settings-card-subtitle" data-i18n="settingsExt.mysqlSubtitle">C∆° s·ªü d·ªØ li·ªáu</div>
                            </div>
                        </div>

                        <div class="info-box">
                            üí° <span data-i18n="settingsExt.mysqlHint">Nh·∫≠p th√¥ng tin k·∫øt n·ªëi MySQL. Nh·∫•n "Ki·ªÉm tra" ƒë·ªÉ x√°c minh k·∫øt n·ªëi tr∆∞·ªõc khi l∆∞u.</span>
                        </div>

                        <!-- Tr·∫°ng th√°i k·∫øt n·ªëi -->
                        <div class="form-group" style="margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid var(--border-color);">
                            <label class="form-label">üìä <span data-i18n="settingsExt.connectionStatus">Tr·∫°ng th√°i k·∫øt n·ªëi hi·ªán t·∫°i</span></label>
                            <div style="margin-top: 8px;">
                                <span class="status-badge" id="dbStatus">
                                    <span class="status-dot"></span>
                                    <span data-i18n="settingsExt.checking">ƒêang ki·ªÉm tra...</span>
                                </span>
                            </div>
                            <div id="dbStatusDetails" style="margin-top: 12px; font-size: 13px; color: var(--text-secondary);"></div>
                        </div>

                        <!-- Th√¥ng tin k·∫øt n·ªëi -->
                        <div style="margin-bottom: 20px;">
                            <label class="form-label" style="margin-bottom: 15px;">‚öôÔ∏è <span data-i18n="settingsExt.connectionInfo">Th√¥ng tin k·∫øt n·ªëi</span></label>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" data-i18n="settingsExt.host">Host</label>
                                    <input type="text" class="form-control" id="mysqlHost" placeholder="localhost" value="localhost">
                                    <div class="form-label-note" data-i18n="settingsExt.hostNote">VD: localhost, 127.0.0.1, mysql.example.com</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" data-i18n="settingsExt.port">Port</label>
                                    <input type="number" class="form-control" id="mysqlPort" placeholder="3306" value="3306">
                                    <div class="form-label-note" data-i18n="settingsExt.portNote">M·∫∑c ƒë·ªãnh: 3306</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-i18n="settingsExt.username">Username</label>
                                <input type="text" class="form-control" id="mysqlUser" placeholder="root">
                                <div class="form-label-note" data-i18n="settingsExt.usernameNote">T√™n ƒëƒÉng nh·∫≠p MySQL</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-i18n="settingsExt.password">Password</label>
                                <input type="password" class="form-control" id="mysqlPass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                <div class="form-label-note" data-i18n="settingsExt.passwordNote">M·∫≠t kh·∫©u (ƒë·ªÉ tr·ªëng n·∫øu kh√¥ng c√≥)</div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" data-i18n="settingsExt.database">Database</label>
                                <input type="text" class="form-control" id="mysqlDb" placeholder="sensor_data">
                                <div class="form-label-note" data-i18n="settingsExt.databaseNote">T√™n c∆° s·ªü d·ªØ li·ªáu</div>
                            </div>
                        </div>

                        <!-- N√∫t h√†nh ƒë·ªông -->
                        <div class="btn-container">
                            <button class="btn-secondary" type="button" onclick="testMysqlConnection()" style="flex: 1;">üîó <span data-i18n="settingsExt.testConnection">Ki·ªÉm tra k·∫øt n·ªëi</span></button>
                            <button class="btn-save" type="button" onclick="saveMysqlSettings()" style="flex: 1;">üíæ <span data-i18n="settingsExt.saveSettings">L∆∞u c√†i ƒë·∫∑t</span></button>
                        </div>
                    </div>

                    <!-- ƒêi·ªÅu khi·ªÉn h·ªá th·ªëng -->
                    <div class="settings-card">
                        <div class="settings-card-header">
                            <div class="settings-card-icon">‚ö°</div>
                            <div>
                                <div class="settings-card-title" data-i18n="settingsExt.systemControl">ƒêi·ªÅu khi·ªÉn h·ªá th·ªëng</div>
                                <div class="settings-card-subtitle" data-i18n="settingsExt.controlSubtitle">Qu·∫£n l√Ω server & thi·∫øt b·ªã</div>
                            </div>
                        </div>

                        <div class="info-box warning" style="margin-bottom: 20px;">
                            ‚ö†Ô∏è <span data-i18n="settingsExt.warningActions">C√°c h√†nh ƒë·ªông d∆∞·ªõi ƒë√¢y s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn h·ªá th·ªëng. H√£y c·∫©n th·∫≠n!</span>
                        </div>

                        <div class="system-control-group">
                            <div class="control-item">
                                <div class="control-label">üîÑ <span data-i18n="settingsExt.restartApp">Kh·ªüi ƒë·ªông l·∫°i Server Web</span></div>
                                <p class="control-desc" data-i18n="settingsExt.restartAppDesc">Restart ·ª©ng d·ª•ng web, d·ªØ li·ªáu ƒë∆∞·ª£c l∆∞u gi·ªØ</p>
                                <button class="btn-control danger" onclick="restartWebServer()">üîÑ <span data-i18n="settingsExt.restartAppBtn">Restart Web</span></button>
                            </div>

                            <div class="control-divider"></div>

                            <div class="control-item">
                                <div class="control-label">üîå <span data-i18n="settingsExt.restartPi">Kh·ªüi ƒë·ªông l·∫°i Raspberry Pi</span></div>
                                <p class="control-desc" data-i18n="settingsExt.restartPiDesc">Restart to√†n b·ªô h·ªá th·ªëng (m·∫•t k·∫øt n·ªëi t·∫°m th·ªùi)</p>
                                <button class="btn-control danger" onclick="rebootRaspberryPi()">üîå <span data-i18n="settingsExt.restartPiBtn">Reboot Pi</span></button>
                            </div>

                            <div class="control-divider"></div>

                            <div class="control-item">
                                <div class="control-label">üßπ <span data-i18n="settingsExt.clearCache">Clear Cache & Logs</span></div>
                                <p class="control-desc" data-i18n="settingsExt.clearCacheDesc">X√≥a b·ªô nh·ªõ ƒë·ªám v√† c√°c file log c≈©</p>
                                <button class="btn-control warning" onclick="clearCacheLogs()">üßπ <span data-i18n="settingsExt.clearCacheBtn">Clear Cache</span></button>
                            </div>

                            <div class="control-divider"></div>

                            <div class="control-item">
                                <div class="control-label">üíæ <span data-i18n="settingsExt.backupDb">Sao l∆∞u c∆° s·ªü d·ªØ li·ªáu</span></div>
                                <p class="control-desc" data-i18n="settingsExt.backupDbDesc">T·∫°o backup c·ªßa d·ªØ li·ªáu hi·ªán t·∫°i</p>
                                <button class="btn-control info" onclick="backupDatabase()">üíæ <span data-i18n="settingsExt.backupDbBtn">Backup DB</span></button>
                            </div>

                            <div class="control-divider"></div>

                            <div class="control-item">
                                <div class="control-label">‚ÑπÔ∏è <span data-i18n="settingsExt.systemInfo">Th√¥ng tin h·ªá th·ªëng</span></div>
                                <p class="control-desc" data-i18n="settingsExt.systemInfoDesc">Xem chi ti·∫øt h·ªá th·ªëng v√† t√†i nguy√™n</p>
                                <button class="btn-control info" onclick="showSystemInfo()">‚ÑπÔ∏è <span data-i18n="settingsExt.systemInfoBtn">Chi ti·∫øt</span></button>
                            </div>
                        </div>
                    </div>

                </div>
            </section>
        </main>
    </div>

    <!-- Toast -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="/static/js/app.js"></script>
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            updateClock();
            setInterval(updateClock, 1000);
            loadAllSettings();
            refreshSystemStats(); // Load initial system stats
            setInterval(refreshSystemStats, 3000); // Auto-refresh
            checkDatabaseStatus();
            
            // Add Enter key event to search location input
            const searchInput = document.getElementById('searchLocationInput');
            if (searchInput) {
                searchInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        searchLocationByName();
                    }
                });
            }
        });

        // Theme
        function initTheme() {
            const toggle = document.getElementById('themeToggle');
            const theme = localStorage.getItem('theme') || 'light';
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                toggle.textContent = '‚òÄÔ∏è';
            }
            toggle.addEventListener('click', () => {
                const isDark = document.body.classList.toggle('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                toggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
            });
        }

        // Clock
        function updateClock() {
            const now = new Date();
            const time = String(now.getHours()).padStart(2, '0') + ':' +
                        String(now.getMinutes()).padStart(2, '0') + ':' +
                        String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clockTime').textContent = time;
        }

        // Load all settings
        async function loadAllSettings() {
            try {
                const response = await fetch('/api/settings');
                const data = await response.json();
                if (data.success) {
                    populateSettings(data.settings);
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }

        // Populate settings
        function populateSettings(settings) {
            // Device
            if (settings.device) {
                document.getElementById('deviceName').value = settings.device.name || '';
                document.getElementById('deviceType').value = settings.device.type || '';
                document.getElementById('deviceDesc').value = settings.device.description || '';
            }

            // Location
            if (settings.location) {
                document.getElementById('locationName').value = settings.location.name || '';
                document.getElementById('locationAddress').value = settings.location.address || '';
                document.getElementById('latitude').value = settings.location.latitude || '';
                document.getElementById('longitude').value = settings.location.longitude || '';
                document.getElementById('altitude').value = settings.location.altitude || '';
            }

            // MySQL
            if (settings.mysql) {
                document.getElementById('mysqlHost').value = settings.mysql.host || 'localhost';
                document.getElementById('mysqlPort').value = settings.mysql.port || 3306;
                document.getElementById('mysqlUser').value = settings.mysql.user || '';
                document.getElementById('mysqlDb').value = settings.mysql.db || '';
            }
        }

        // Update device temperature
        async function updateDeviceTemp() {
            try {
                const response = await fetch('/api/system/temperature');
                const data = await response.json();
                if (data.success) {
                    document.getElementById('deviceTempValue').textContent = data.temperature.toFixed(1) + ' ¬∞C';
                }
            } catch (error) {
                console.error('Error updating temperature:', error);
            }
        }

        // Check database status
        async function checkDatabaseStatus() {
            try {
                const response = await fetch('/api/database/status');
                const data = await response.json();
                const badge = document.getElementById('dbStatus');
                if (data.success && data.connected) {
                    badge.innerHTML = '<span class="status-dot"></span><span>‚úì K·∫øt n·ªëi OK</span>';
                    badge.className = 'status-badge';
                } else {
                    badge.innerHTML = '<span class="status-dot"></span><span>‚úó M·∫•t k·∫øt n·ªëi</span>';
                    badge.className = 'status-badge error';
                }
            } catch (error) {
                const badge = document.getElementById('dbStatus');
                badge.innerHTML = '<span class="status-dot"></span><span>‚úó L·ªói</span>';
                badge.className = 'status-badge error';
            }
        }

        // Get location from location name
        async function useCurrentLocation() {
            if (!navigator.geolocation) {
                AppUtils.showToast('‚úó Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Geolocation', 'error');
                return;
            }

            AppUtils.showToast('üìç ƒêang l·∫•y v·ªã tr√≠ hi·ªán t·∫°i...', 'info');

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const accuracy = position.coords.accuracy;

                    // Set coordinates
                    document.getElementById('latitude').value = lat.toFixed(6);
                    document.getElementById('longitude').value = lon.toFixed(6);
                    document.getElementById('altitude').value = (position.coords.altitude || 0).toFixed(1);

                    // Try to get location name from reverse geocoding
                    try {
                        const response = await fetch(`/api/location/reverse?lat=${lat}&lon=${lon}`);
                        const data = await response.json();
                        
                        if (data.success && data.location) {
                            document.getElementById('locationName').value = data.location.name || '';
                            document.getElementById('locationAddress').value = data.location.address || '';
                        }
                    } catch (error) {
                        console.error('Error reverse geocoding:', error);
                    }

                    AppUtils.showToast('‚úì ƒê√£ l·∫•y v·ªã tr√≠ hi·ªán t·∫°i th√†nh c√¥ng!', 'success');
                },
                (error) => {
                    let message = 'L·ªói khi l·∫•y v·ªã tr√≠';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = 'B·∫°n ƒë√£ t·ª´ ch·ªëi quy·ªÅn truy c·∫≠p v·ªã tr√≠';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = 'Th√¥ng tin v·ªã tr√≠ kh√¥ng kh·∫£ d·ª•ng';
                            break;
                        case error.TIMEOUT:
                            message = 'Timeout khi l·∫•y v·ªã tr√≠';
                            break;
                    }
                    AppUtils.showToast('‚úó ' + message, 'error');
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        async function getLocationFromName() {
            const locationName = document.getElementById('locationName').value.trim();
            
            if (!locationName) {
                AppUtils.showToast('‚ö†Ô∏è Vui l√≤ng nh·∫≠p t√™n ƒë·ªãa ƒëi·ªÉm', 'warning');
                return;
            }

            try {
                AppUtils.showToast('üîç ƒêang t√¨m t·ªça ƒë·ªô...', 'info');
                const response = await fetch(`/api/location/geocode?name=${encodeURIComponent(locationName)}`);
                const data = await response.json();
                
                if (data.success && data.location) {
                    document.getElementById('locationAddress').value = data.location.address || locationName;
                    document.getElementById('latitude').value = data.location.latitude || '';
                    document.getElementById('longitude').value = data.location.longitude || '';
                    document.getElementById('altitude').value = data.location.altitude || '';
                    AppUtils.showToast('‚úì L·∫•y t·ªça ƒë·ªô th√†nh c√¥ng!', 'success');
                } else {
                    AppUtils.showToast('‚úó Kh√¥ng t√¨m th·∫•y v·ªã tr√≠: ' + (data.message || 'Vui l√≤ng th·ª≠ l·∫°i'), 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                AppUtils.showToast('‚úó L·ªói khi l·∫•y t·ªça ƒë·ªô', 'error');
            }
        }

        // Save functions
        async function saveDeviceSettings() {
            const settings = {
                device: {
                    name: document.getElementById('deviceName').value,
                    type: document.getElementById('deviceType').value,
                    description: document.getElementById('deviceDesc').value
                }
            };
            await saveSetting(settings);
        }

        async function saveLocationSettings() {
            const settings = {
                location: {
                    name: document.getElementById('locationName').value,
                    address: document.getElementById('locationAddress').value,
                    latitude: parseFloat(document.getElementById('latitude').value),
                    longitude: parseFloat(document.getElementById('longitude').value),
                    altitude: parseFloat(document.getElementById('altitude').value),
                    timezone: document.getElementById('timezone').value
                }
            };
            await saveSetting(settings);
        }

        async function saveMysqlSettings() {
            const settings = {
                mysql: {
                    host: document.getElementById('mysqlHost').value,
                    port: parseInt(document.getElementById('mysqlPort').value),
                    user: document.getElementById('mysqlUser').value,
                    password: document.getElementById('mysqlPass').value,
                    db: document.getElementById('mysqlDb').value
                }
            };
            await saveSetting(settings);
        }

        async function saveSetting(settings) {
            try {
                const response = await fetch('/api/settings', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                const data = await response.json();
                if (data.success) {
                    AppUtils.showToast('‚úì L∆∞u th√†nh c√¥ng', 'success');
                } else {
                    AppUtils.showToast('‚úó L·ªói: ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                AppUtils.showToast('‚úó L·ªói khi l∆∞u c√†i ƒë·∫∑t', 'error');
            }
        }

        async function testMysqlConnection() {
            const host = document.getElementById('mysqlHost').value.trim();
            const port = document.getElementById('mysqlPort').value.trim();
            const user = document.getElementById('mysqlUser').value.trim();
            const password = document.getElementById('mysqlPass').value;
            const db = document.getElementById('mysqlDb').value.trim();

            // Validate inputs
            if (!host || !port || !user || !db) {
                AppUtils.showToast('‚ö†Ô∏è Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin k·∫øt n·ªëi', 'warning');
                return;
            }

            try {
                AppUtils.showToast('üîó ƒêang ki·ªÉm tra k·∫øt n·ªëi...', 'info');
                
                const requestData = {
                    host: host,
                    port: parseInt(port),
                    user: user,
                    password: password || '',
                    db: db
                };
                
                console.log('Sending test request:', requestData);
                
                const response = await fetch('/api/database/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });
                
                console.log('Response status:', response.status);
                const data = await response.json();
                console.log('Response data:', data);
                
                if (data.success) {
                    AppUtils.showToast('‚úì K·∫øt n·ªëi MySQL th√†nh c√¥ng!', 'success');
                    updateMysqlStatusDisplay(true, 'K·∫øt n·ªëi th√†nh c√¥ng');
                    checkDatabaseStatus();
                } else {
                    const errorMsg = data.message || 'L·ªói kh√¥ng x√°c ƒë·ªãnh';
                    AppUtils.showToast('‚úó K·∫øt n·ªëi th·∫•t b·∫°i: ' + errorMsg, 'error');
                    updateMysqlStatusDisplay(false, errorMsg);
                }
            } catch (error) {
                console.error('Error:', error);
                AppUtils.showToast('‚úó L·ªói khi ki·ªÉm tra k·∫øt n·ªëi: ' + error.message, 'error');
                updateMysqlStatusDisplay(false, 'L·ªói k·∫øt n·ªëi: ' + error.message);
            }
        }

        function updateMysqlStatusDisplay(success, info) {
            const badge = document.getElementById('dbStatus');
            const details = document.getElementById('dbStatusDetails');
            
            if (success) {
                badge.innerHTML = '<span class="status-dot"></span><span>‚úì K·∫øt n·ªëi OK</span>';
                badge.className = 'status-badge';
                details.innerHTML = `<strong>‚úì K·∫øt n·ªëi th√†nh c√¥ng</strong><br>
                    üñ•Ô∏è Host: <code>${document.getElementById('mysqlHost').value}</code><br>
                    üîå Port: <code>${document.getElementById('mysqlPort').value}</code><br>
                    üë§ User: <code>${document.getElementById('mysqlUser').value}</code><br>
                    üíæ Database: <code>${document.getElementById('mysqlDb').value}</code>`;
            } else {
                badge.innerHTML = '<span class="status-dot"></span><span>‚úó L·ªói k·∫øt n·ªëi</span>';
                badge.className = 'status-badge error';
                details.innerHTML = `<strong>‚úó K·∫øt n·ªëi th·∫•t b·∫°i</strong><br><code style="font-size: 11px; color: #f56565;">${info}</code>`;
            }
        }

        // System Control Functions
        async function restartWebServer() {
            if (!confirm('‚ö†Ô∏è B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën restart web server kh√¥ng? K·∫øt n·ªëi s·∫Ω b·ªã ng·∫Øt trong v√†i gi√¢y.')) {
                return;
            }

            try {
                AppUtils.showToast('‚è≥ ƒêang kh·ªüi ƒë·ªông l·∫°i server...', 'info');
                const response = await fetch('/api/system/restart-server', { method: 'POST' });
                
                if (response.ok) {
                    setTimeout(() => {
                        window.location.reload();
                    }, 2000);
                }
            } catch (error) {
                // Server restart s·∫Ω l√†m m·∫•t k·∫øt n·ªëi, n√™n error l√† b√¨nh th∆∞·ªùng
                AppUtils.showToast('‚è≥ Server ƒëang kh·ªüi ƒë·ªông l·∫°i. Trang s·∫Ω t·∫£i l·∫°i...', 'info');
                setTimeout(() => {
                    window.location.reload();
                }, 3000);
            }
        }

        async function rebootRaspberryPi() {
            if (!confirm('‚ö†Ô∏è B·∫†N CH·ªÆ CH·∫ÆN MU·ªêN REBOOT RASPBERRY PI?\n\n- H·ªá th·ªëng s·∫Ω t·∫Øt\n- M·∫•t k·∫øt n·ªëi trong 1-2 ph√∫t\n- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c l∆∞u gi·ªØ\n\nClick OK ƒë·ªÉ ti·∫øp t·ª•c')) {
                return;
            }

            if (!confirm('‚ö†Ô∏è C·∫¢NH B√ÅO CU·ªêI C√ôNG!\n\nƒê√¢y l√† h√†nh ƒë·ªông kh√¥ng th·ªÉ h·ªßy. Ti·∫øp t·ª•c?')) {
                return;
            }

            try {
                AppUtils.showToast('üîå ƒêang reboot Raspberry Pi... Trang s·∫Ω ƒë∆∞·ª£c t·∫£i l·∫°i', 'warning');
                await fetch('/api/system/reboot-pi', { method: 'POST' });
                
                // Sau reboot, t·ª± ƒë·ªông t·∫£i l·∫°i trang
                setTimeout(() => {
                    window.location.reload();
                }, 10000);
            } catch (error) {
                AppUtils.showToast('Raspberry Pi ƒëang reboot. H√£y ch·ªù...', 'info');
                setTimeout(() => {
                    window.location.reload();
                }, 10000);
            }
        }

        async function clearCacheLogs() {
            if (!confirm('üßπ B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a cache v√† logs kh√¥ng?\n\nH√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.')) {
                return;
            }

            try {
                const loading = AppUtils.showLoading(document.querySelector('.settings-container'));
                const response = await fetch('/api/system/clear-cache', { method: 'POST' });
                const data = await response.json();
                
                AppUtils.hideLoading(loading);
                if (data.success) {
                    AppUtils.showToast('‚úì ƒê√£ x√≥a cache v√† logs th√†nh c√¥ng', 'success');
                } else {
                    AppUtils.showToast('‚úó L·ªói: ' + data.message, 'error');
                }
            } catch (error) {
                AppUtils.showToast('‚úó L·ªói khi x√≥a cache', 'error');
            }
        }

        async function backupDatabase() {
            try {
                const loading = AppUtils.showLoading(document.querySelector('.settings-container'));
                AppUtils.showToast('üíæ ƒêang t·∫°o backup...', 'info');
                
                const response = await fetch('/api/system/backup-db', { method: 'POST' });
                const data = await response.json();
                
                AppUtils.hideLoading(loading);
                if (data.success) {
                    AppUtils.showToast('‚úì Backup th√†nh c√¥ng: ' + data.filename, 'success');
                } else {
                    AppUtils.showToast('‚úó L·ªói: ' + data.message, 'error');
                }
            } catch (error) {
                AppUtils.showToast('‚úó L·ªói khi backup database', 'error');
            }
        }

        async function showSystemInfo() {
            try {
                const response = await fetch('/api/system/info');
                const data = await response.json();
                
                if (data.success) {
                    const info = data.system;
                    const message = `
üìä TH√îNG TIN H·ªÜ TH·ªêNG
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üñ•Ô∏è  Hostname: ${info.hostname || '--'}
üíª OS: ${info.os || '--'}
üìå Kernel: ${info.kernel || '--'}
‚öôÔ∏è  Cores: ${info.cpu_cores || '--'}

üíæ RAM: ${info.ram_used || '--'} / ${info.ram_total || '--'}
üì¶ Storage: ${info.disk_used || '--'} / ${info.disk_total || '--'}
üå°Ô∏è  Nhi·ªát ƒë·ªô CPU: ${info.cpu_temp || '--'}¬∞C
‚è±Ô∏è  Uptime: ${info.uptime || '--'}
                    `;
                    alert(message);
                } else {
                    AppUtils.showToast('‚úó Kh√¥ng th·ªÉ t·∫£i th√¥ng tin h·ªá th·ªëng', 'error');
                }
            } catch (error) {
                AppUtils.showToast('‚úó L·ªói khi t·∫£i th√¥ng tin', 'error');
            }
        }

        // Refresh System Stats
        async function refreshSystemStats() {
            try {
                const response = await fetch('/api/system/info');
                const data = await response.json();

                if (data.success && data.system) {
                    const sys = data.system;

                    // CPU
                    const cpuUsage = sys.cpu_usage || 0;
                    document.getElementById('cpuUsage').textContent = cpuUsage.toFixed(1) + '%';
                    document.getElementById('cpuCores').textContent = sys.cpu_cores || '--';
                    document.getElementById('cpuFreq').textContent = (sys.cpu_freq || 0).toFixed(0);
                    document.getElementById('cpuProgressBar').style.width = cpuUsage + '%';

                    // RAM
                    const ramUsed = sys.ram_used || 0;
                    const ramTotal = sys.ram_total || 1;
                    const ramPercent = (ramUsed / ramTotal) * 100;
                    document.getElementById('ramUsage').textContent = ramPercent.toFixed(1) + '%';
                    document.getElementById('ramUsed').textContent = ramUsed.toFixed(0);
                    document.getElementById('ramTotal').textContent = ramTotal.toFixed(0);
                    document.getElementById('ramProgressBar').style.width = ramPercent + '%';

                    // GPU Memory
                    const gpuMem = sys.gpu_mem || 0;
                    const gpuAllocated = sys.gpu_mem_allocated || 0;
                    const gpuPercent = gpuAllocated > 0 ? (gpuAllocated / gpuMem) * 100 : 0;
                    document.getElementById('gpuMem').textContent = gpuPercent.toFixed(1) + '%';
                    document.getElementById('gpuAllocated').textContent = gpuAllocated.toFixed(0);
                    document.getElementById('gpuProgressBar').style.width = Math.min(gpuPercent, 100) + '%';

                    // Temperature
                    const cpuTemp = sys.cpu_temp || 0;
                    const tempElement = document.getElementById('cpuTemp');
                    const tempStatusElement = document.getElementById('tempStatus');
                    
                    tempElement.textContent = cpuTemp.toFixed(1) + ' ¬∞C';
                    
                    if (cpuTemp < 50) {
                        tempElement.className = 'stat-value temp-good';
                        tempStatusElement.className = 'temp-status-good';
                        tempStatusElement.textContent = '‚úì B√¨nh th∆∞·ªùng';
                        document.getElementById('tempProgressBar').style.width = (cpuTemp / 80) * 100 + '%';
                    } else if (cpuTemp < 70) {
                        tempElement.className = 'stat-value temp-warning';
                        tempStatusElement.className = 'temp-status-warning';
                        tempStatusElement.textContent = '‚ö†Ô∏è N√≥ng';
                        document.getElementById('tempProgressBar').style.width = (cpuTemp / 80) * 100 + '%';
                    } else {
                        tempElement.className = 'stat-value temp-danger';
                        tempStatusElement.className = 'temp-status-danger';
                        tempStatusElement.textContent = 'üî¥ Nguy hi·ªÉm';
                        document.getElementById('tempProgressBar').style.width = '100%';
                    }

                    // Storage
                    const diskUsed = sys.disk_used || 0;
                    const diskTotal = sys.disk_total || 1;
                    const diskPercent = (diskUsed / diskTotal) * 100;
                    document.getElementById('storageUsage').textContent = diskPercent.toFixed(1) + '%';
                    document.getElementById('storageUsed').textContent = diskUsed.toFixed(1);
                    document.getElementById('storageTotal').textContent = diskTotal.toFixed(1);
                    document.getElementById('storageProgressBar').style.width = diskPercent + '%';

                    // Uptime
                    const uptime = sys.uptime || 0;
                    const hours = Math.floor(uptime / 3600);
                    const minutes = Math.floor((uptime % 3600) / 60);
                    document.getElementById('uptimeValue').textContent = hours + ' h';
                    
                    // Get boot time
                    const bootTime = new Date(Date.now() - uptime * 1000);
                    const bootTimeStr = bootTime.toLocaleString('vi-VN');
                    document.getElementById('bootTime').textContent = bootTimeStr;
                } else {
                    AppUtils.showToast('‚úó Kh√¥ng th·ªÉ t·∫£i th√¥ng tin', 'error');
                }
            } catch (error) {
                console.error('Error refreshing stats:', error);
                AppUtils.showToast('‚úó L·ªói khi c·∫≠p nh·∫≠t th√¥ng tin', 'error');
            }
        }
    </script>
</body>

</html>
