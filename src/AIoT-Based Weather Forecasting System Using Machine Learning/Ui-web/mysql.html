<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω d·ªØ li·ªáu MySQL - AIoT Weather</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">
                <span class="logo-icon">üå§Ô∏è</span>
                <div>
                    <div class="app-title">AIoT Weather</div>
                    <div class="app-subtitle">AIoT-ML</div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üè†</span>
                        <span>T·ªïng quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="charts.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span>Bi·ªÉu ƒë·ªì & Ph√¢n t√≠ch</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="forecast.html" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>D·ª± b√°o (ML)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="ml-training.html" class="nav-link">
                        <span class="nav-icon">üöÄ</span>
                        <span>Hu·∫•n luy·ªán ML</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="mysql.html" class="nav-link">
                        <span class="nav-icon">üíæ</span>
                        <span>Qu·∫£n l√Ω d·ªØ li·ªáu MySQL</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>C·∫•u h√¨nh h·ªá th·ªëng</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
                <h1 class="page-title">Qu·∫£n l√Ω d·ªØ li·ªáu MySQL</h1>
            </div>
            <div class="topbar-right">
                <div class="clock-display">
                    <span class="clock-time" id="clockTime">00:00:00</span>
                    <span class="clock-label">GMT+7</span>
                </div>
                <div class="status-badge connected" id="mysqlStatus">
                    <span class="status-dot"></span> MySQL: Connected
                </div>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- Database Summary -->
            <section class="section">
                <h2 class="section-title">T·ªïng quan c∆° s·ªü d·ªØ li·ªáu</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">T·ªïng s·ªë b·∫£n ghi</div>
                        <div class="stat-value" id="totalRecords">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Dung l∆∞·ª£ng ∆∞·ªõc t√≠nh</div>
                        <div class="stat-value" style="font-size: 18px;" id="storageSize">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">B·∫£n ghi m·ªõi nh·∫•t</div>
                        <div class="stat-value" style="font-size: 14px;" id="latestRecord">--</div>
                    </div>
                </div>
            </section>

            <!-- Filter Controls -->
            <section class="section">
                <div class="filter-panel">
                    <h3 class="section-title">B·ªô l·ªçc & T√¨m ki·∫øm</h3>

                    <div class="filter-row">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label class="form-label">Kho·∫£ng th·ªùi gian</label>
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="setTimeFilter('today')">H√¥m nay</button>
                                <button class="btn btn-secondary" onclick="setTimeFilter('24h')">24 gi·ªù qua</button>
                                <button class="btn btn-secondary" onclick="setTimeFilter('7d')">7 ng√†y qua</button>
                                <button class="btn btn-secondary" onclick="setTimeFilter('all')">T·∫•t c·∫£</button>
                            </div>
                        </div>
                    </div>

                    <div class="filter-row">
                        <div class="form-group" style="flex: 1; margin-bottom: 0;">
                            <label class="form-label">Node</label>
                            <select class="form-select" id="nodeFilter">
                                <option value="all">T·∫•t c·∫£</option>
                                <option value="node1">Node 1</option>
                                <option value="node2">Node 2</option>
                            </select>
                        </div>
                        <div class="form-group" style="flex: 2; margin-bottom: 0;">
                            <label class="form-label">T√¨m ki·∫øm (ID ho·∫∑c th·ªùi gian)</label>
                            <input type="text" class="form-input" id="searchInput"
                                placeholder="Nh·∫≠p ID ho·∫∑c th·ªùi gian...">
                        </div>
                    </div>

                    <div class="filter-row">
                        <button class="btn btn-primary" onclick="loadTableData()">
                            üîç L√†m m·ªõi d·ªØ li·ªáu
                        </button>
                    </div>
                </div>
            </section>

            <!-- Data Table -->
            <section class="section">
                <h2 class="section-title">B·∫£ng d·ªØ li·ªáu</h2>
                <div class="table-container">
                    <div class="table-wrapper">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Th·ªùi gian</th>
                                    <th>Node</th>
                                    <th>Nhi·ªát ƒë·ªô (¬∞C)</th>
                                    <th>ƒê·ªô ·∫©m (%)</th>
                                    <th>√Åp su·∫•t (hPa)</th>
                                    <th>CO‚ÇÇ (ppm)</th>
                                    <th>B·ª•i m·ªãn (¬µg/m¬≥)</th>
                                    <th>AQI</th>
                                </tr>
                            </thead>
                            <tbody id="dataTableBody">
                                <tr>
                                    <td colspan="9" style="text-align: center; padding: 30px;">
                                        <div class="loading"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="pagination">
                        <button class="btn btn-secondary" onclick="previousPage()">‚Üê Tr∆∞·ªõc</button>
                        <span class="pagination-info" id="paginationInfo">Trang 1</span>
                        <button class="btn btn-secondary" onclick="nextPage()">Sau ‚Üí</button>
                    </div>
                </div>
            </section>

            <!-- Data Cleanup -->
            <section class="section">
                <h2 class="section-title">D·ªçn d·∫πp d·ªØ li·ªáu</h2>
                <div class="card">
                    <div class="info-panel">
                        <div class="info-panel-title">‚ö†Ô∏è C·∫£nh b√°o</div>
                        <div class="info-panel-content">
                            Vi·ªác x√≥a d·ªØ li·ªáu c≈© s·∫Ω gi√∫p gi·∫£m dung l∆∞·ª£ng c∆° s·ªü d·ªØ li·ªáu. Tuy nhi√™n, d·ªØ li·ªáu ƒë√£ x√≥a kh√¥ng
                            th·ªÉ kh√¥i ph·ª•c ƒë∆∞·ª£c.
                        </div>
                    </div>

                    <div class="form-group mt-20">
                        <label class="form-label">Ch·ªçn kho·∫£ng th·ªùi gian c·∫ßn x√≥a</label>
                        <div class="form-radio">
                            <input type="radio" name="deleteRange" value="7" id="delete7" checked>
                            <label for="delete7">X√≥a d·ªØ li·ªáu c≈© h∆°n 7 ng√†y</label>
                        </div>
                        <div class="form-radio">
                            <input type="radio" name="deleteRange" value="30" id="delete30">
                            <label for="delete30">X√≥a d·ªØ li·ªáu c≈© h∆°n 30 ng√†y</label>
                        </div>
                        <div class="form-radio">
                            <input type="radio" name="deleteRange" value="90" id="delete90">
                            <label for="delete90">X√≥a d·ªØ li·ªáu c≈© h∆°n 90 ng√†y</label>
                        </div>
                    </div>

                    <div class="mt-20">
                        <button class="btn btn-danger" onclick="confirmDelete()">
                            üóëÔ∏è X√≥a d·ªØ li·ªáu c≈©
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal-overlay" id="modalOverlay">
        <div class="modal">
            <div class="modal-header" id="modalTitle">X√°c nh·∫≠n x√≥a d·ªØ li·ªáu</div>
            <div class="modal-body" id="modalBody">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªØ li·ªáu c≈© kh√¥ng?</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="modalCancel">H·ªßy</button>
                <button class="btn btn-danger" id="modalConfirm">X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        let currentPage = 1;
        let totalPages = 10;
        let currentTimeFilter = 'today';
        let tableData = null;

        // Set time filter
        function setTimeFilter(filter) {
            currentTimeFilter = filter;
            // Update button styles
            document.querySelectorAll('.filter-row .btn-group .btn').forEach(btn => {
                btn.className = 'btn btn-secondary';
            });
            event.target.className = 'btn btn-primary';
        }

        // Load table data
        async function loadTableData() {
            const tableBody = document.getElementById('dataTableBody');
            tableBody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 30px;"><div class="loading"></div></td></tr>';

            try {
                tableData = await AppUtils.fetchMySQLTable({
                    timeFilter: currentTimeFilter,
                    page: currentPage
                });

                // Update summary stats
                document.getElementById('totalRecords').textContent = tableData.totalRecords.toLocaleString('vi-VN');
                document.getElementById('storageSize').textContent = tableData.storageSize;
                document.getElementById('latestRecord').textContent = tableData.latestRecord;

                // Update table
                tableBody.innerHTML = '';
                tableData.records.forEach(record => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
            <td>${record.id}</td>
            <td>${record.time}</td>
            <td>${record.node}</td>
            <td>${record.temperature}</td>
            <td>${record.humidity}</td>
            <td>${record.pressure}</td>
            <td>${record.co2}</td>
            <td>${record.dust}</td>
            <td>${record.aqi}</td>
          `;
                    tableBody.appendChild(row);
                });

                // Update pagination
                document.getElementById('paginationInfo').textContent = `Trang ${currentPage} / ${totalPages}`;

                AppUtils.showToast('ƒê√£ t·∫£i d·ªØ li·ªáu th√†nh c√¥ng', 'success');
            } catch (error) {
                tableBody.innerHTML = `<tr><td colspan="9" style="text-align: center; padding: 30px; color: var(--danger);">L·ªói: ${error.message}</td></tr>`;
                AppUtils.showToast(error.message, 'error');
            }
        }

        // Pagination
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                loadTableData();
            }
        }

        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                loadTableData();
            }
        }

        // Confirm delete
        function confirmDelete() {
            const selectedRange = document.querySelector('input[name="deleteRange"]:checked').value;

            AppUtils.showModal(
                'X√°c nh·∫≠n x√≥a d·ªØ li·ªáu',
                `B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a d·ªØ li·ªáu c≈© h∆°n ${selectedRange} ng√†y kh·ªèi MySQL kh√¥ng? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c.`,
                () => {
                    // Simulate delete operation
                    setTimeout(() => {
                        AppUtils.showToast(`ƒê√£ x√≥a d·ªØ li·ªáu c≈© h∆°n ${selectedRange} ng√†y (gi·∫£ l·∫≠p)`, 'success');
                        loadTableData();
                    }, 500);
                },
                null
            );
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadTableData();
        });
    </script>
</body>

</html>