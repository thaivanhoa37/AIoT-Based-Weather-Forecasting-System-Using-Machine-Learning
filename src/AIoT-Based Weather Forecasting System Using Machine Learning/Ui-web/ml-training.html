<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hu·∫•n luy·ªán Model ML - AIoT Weather</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">
                <span class="logo-icon">üå§Ô∏è</span>
                <div>
                    <div class="app-title">AIoT Weather</div>
                    <div class="app-subtitle">AIoT-ML</div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üè†</span>
                        <span>T·ªïng quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="charts.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span>Bi·ªÉu ƒë·ªì & Ph√¢n t√≠ch</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="forecast.html" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>D·ª± b√°o (ML)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="ml-training.html" class="nav-link active">
                        <span class="nav-icon">üöÄ</span>
                        <span>Hu·∫•n luy·ªán ML</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="mysql.html" class="nav-link">
                        <span class="nav-icon">üíæ</span>
                        <span>Qu·∫£n l√Ω d·ªØ li·ªáu MySQL</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>C·∫•u h√¨nh h·ªá th·ªëng</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
                <h1 class="page-title">üöÄ Hu·∫•n luy·ªán Model ML</h1>
            </div>
            <div class="topbar-right">
                <div class="clock-display">
                    <span class="clock-time" id="clockTime">00:00:00</span>
                    <span class="clock-label">GMT+7</span>
                </div>
                <div class="status-badge connected" id="mysqlStatus">
                    <span class="status-dot"></span> MySQL: Connected
                </div>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- Quick Stats -->
            <section class="section">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                    <div class="stat-info-box">
                        <div class="stat-info-label">ü§ñ Model hi·ªán t·∫°i</div>
                        <div class="stat-info-value" id="currentModel">Prophet</div>
                    </div>
                    <div class="stat-info-box">
                        <div class="stat-info-label">üìÖ Train g·∫ßn nh·∫•t</div>
                        <div class="stat-info-value" id="lastTrainTime">--</div>
                    </div>
                    <div class="stat-info-box">
                        <div class="stat-info-label">üìä D·ªØ li·ªáu ƒë√£ d√πng</div>
                        <div class="stat-info-value" id="trainingDataCount">0</div>
                    </div>
                    <div class="stat-info-box">
                        <div class="stat-info-label">üéØ ƒê·ªô ch√≠nh x√°c</div>
                        <div class="stat-info-value" id="modelAccuracy">--</div>
                    </div>
                </div>
            </section>

            <!-- Training Configuration -->
            <section class="section">
                <h2 class="section-title">‚öôÔ∏è C·∫•u h√¨nh hu·∫•n luy·ªán</h2>
                <div class="card">
                    <form id="trainingConfigForm">
                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ü§ñ Ch·ªçn Model</label>
                                <select class="form-select" id="mlModel">
                                    <option value="prophet" selected>Prophet (Facebook)</option>
                                    <option value="lstm">LSTM (Deep Learning)</option>
                                    <option value="arima">ARIMA</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üìÅ Ngu·ªìn d·ªØ li·ªáu</label>
                                <select class="form-select" id="dataSource">
                                    <option value="mysql" selected>MySQL Local</option>
                                    <option value="firebase">Firebase Realtime Database</option>
                                    <option value="csv">CSV File</option>
                                </select>
                            </div>
                        </div>

                        <div class="filter-row mt-10">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üìÖ Kho·∫£ng th·ªùi gian d·ªØ li·ªáu</label>
                                <input type="number" class="form-input" id="trainingDays" value="30" min="7" max="365">
                                <small style="color: var(--text-secondary); font-size: 11px; margin-top: 5px; display: block;">
                                    S·ªë ng√†y d·ªØ li·ªáu qu√° kh·ª© c·∫ßn d√πng
                                </small>
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üéØ Bi·∫øn d·ª± b√°o ch√≠nh</label>
                                <select class="form-select" id="targetVariable">
                                    <option value="temp" selected>Nhi·ªát ƒë·ªô (¬∞C)</option>
                                    <option value="humidity">ƒê·ªô ·∫©m (%)</option>
                                    <option value="pressure">√Åp su·∫•t (hPa)</option>
                                    <option value="all">T·∫•t c·∫£ bi·∫øn</option>
                                </select>
                            </div>
                        </div>

                        <div class="filter-row mt-10">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üîß T·ª∑ l·ªá train/test</label>
                                <select class="form-select" id="testRatio">
                                    <option value="0.2" selected>80/20 (Khuy·∫øn ngh·ªã)</option>
                                    <option value="0.15">85/15</option>
                                    <option value="0.25">75/25</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">‚ö° C√†i ƒë·∫∑t n√¢ng cao</label>
                                <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 10px;">
                                    <div class="form-checkbox" style="margin: 0;">
                                        <input type="checkbox" id="useGPU">
                                        <label for="useGPU" style="margin: 0;">S·ª≠ d·ª•ng GPU</label>
                                    </div>
                                    <div class="form-checkbox" style="margin: 0;">
                                        <input type="checkbox" id="autoHyperparameter">
                                        <label for="autoHyperparameter" style="margin: 0;">T·ª± ƒë·ªông ƒëi·ªÅu ch·ªânh tham s·ªë</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="info-panel mt-20">
                            <div class="info-panel-content">
                                <strong>üí° H∆∞·ªõng d·∫´n:</strong> 
                                <ul style="margin: 10px 0 0 20px; padding: 0;">
                                    <li>TƒÉng kho·∫£ng th·ªùi gian d·ªØ li·ªáu ƒë·ªÉ c√≥ ƒë·ªô ch√≠nh x√°c cao h∆°n (t·ªëi ƒëa 365 ng√†y)</li>
                                    <li>S·ª≠ d·ª•ng GPU s·∫Ω tƒÉng t·ªëc ƒë·ªô hu·∫•n luy·ªán 10-100 l·∫ßn</li>
                                    <li>T·ª∑ l·ªá 80/20 l√† c√¢n b·∫±ng gi·ªØa hu·∫•n luy·ªán v√† ki·ªÉm tra</li>
                                    <li>Qu√° tr√¨nh hu·∫•n luy·ªán c√≥ th·ªÉ m·∫•t t·ª´ 5 ph√∫t ƒë·∫øn 1 gi·ªù</li>
                                </ul>
                            </div>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Training Control -->
            <section class="section">
                <h2 class="section-title">üé¨ ƒêi·ªÅu khi·ªÉn hu·∫•n luy·ªán</h2>
                <div class="card">
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-primary" onclick="startTraining()" style="flex: 1; min-width: 200px;">
                            üöÄ B·∫Øt ƒë·∫ßu hu·∫•n luy·ªán
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="previewTrainingData()" style="flex: 1; min-width: 200px;">
                            üëÅÔ∏è Xem tr∆∞·ªõc d·ªØ li·ªáu
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="validateData()" style="flex: 1; min-width: 200px;">
                            ‚úì Ki·ªÉm tra d·ªØ li·ªáu
                        </button>
                    </div>
                </div>
            </section>

            <!-- Training Progress -->
            <section class="section" id="trainingSection" style="display: none;">
                <h2 class="section-title">üìà Ti·∫øn tr√¨nh hu·∫•n luy·ªán</h2>
                <div class="card">
                    <div class="progress-container">
                        <div class="progress-bar-large">
                            <div class="progress-fill-large" id="mlProgressFill" style="width: 0%;"></div>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                            <p id="mlTrainingStatus" style="font-size: 14px; font-weight: 600; color: var(--text); margin: 0;">
                                ƒêang chu·∫©n b·ªã...
                            </p>
                            <span id="trainingPercentage" style="font-size: 18px; font-weight: 700; color: var(--accent);">0%</span>
                        </div>
                    </div>

                    <div class="training-steps mt-20">
                        <div class="training-step" id="step-1">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-label">T·∫£i d·ªØ li·ªáu t·ª´ MySQL</span>
                            <span class="step-status"></span>
                        </div>
                        <div class="training-step" id="step-2">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-label">Ti·ªÅn x·ª≠ l√Ω & l√†m s·∫°ch d·ªØ li·ªáu</span>
                            <span class="step-status"></span>
                        </div>
                        <div class="training-step" id="step-3">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-label">X√¢y d·ª±ng m√¥ h√¨nh</span>
                            <span class="step-status"></span>
                        </div>
                        <div class="training-step" id="step-4">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-label">ƒê√°nh gi√° hi·ªáu su·∫•t</span>
                            <span class="step-status"></span>
                        </div>
                        <div class="training-step" id="step-5">
                            <span class="step-icon">‚è≥</span>
                            <span class="step-label">L∆∞u m√¥ h√¨nh</span>
                            <span class="step-status"></span>
                        </div>
                    </div>

                    <div id="trainingResults" class="hidden mt-20">
                        <h3 style="margin-bottom: 15px; color: var(--text);">‚úì K·∫øt qu·∫£ hu·∫•n luy·ªán</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                            <div class="result-box">
                                <div class="result-label">RMSE</div>
                                <div class="result-value" id="resultRMSE">--</div>
                            </div>
                            <div class="result-box">
                                <div class="result-label">MAE</div>
                                <div class="result-value" id="resultMAE">--</div>
                            </div>
                            <div class="result-box">
                                <div class="result-label">R¬≤ Score</div>
                                <div class="result-value" id="resultR2">--</div>
                            </div>
                            <div class="result-box">
                                <div class="result-label">Th·ªùi gian</div>
                                <div class="result-value" id="resultTime">--</div>
                            </div>
                        </div>
                        
                        <div class="info-panel">
                            <div class="info-panel-content">
                                <strong>üìä Gi·∫£i th√≠ch k·∫øt qu·∫£:</strong>
                                <ul style="margin: 10px 0 0 20px; padding: 0;">
                                    <li><strong>RMSE:</strong> Sai s·ªë b√¨nh ph∆∞∆°ng trung b√¨nh (c√†ng th·∫•p c√†ng t·ªët)</li>
                                    <li><strong>MAE:</strong> Sai s·ªë tuy·ªát ƒë·ªëi trung b√¨nh (d·ªÖ hi·ªÉu h∆°n RMSE)</li>
                                    <li><strong>R¬≤ Score:</strong> M·ª©c ƒë·ªô ph√π h·ª£p (0-1, g·∫ßn 1 l√† t·ªët)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Model Comparison -->
            <section class="section">
                <h2 class="section-title">üîç So s√°nh c√°c Model</h2>
                <div class="card">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div class="model-comparison-card">
                            <div class="model-name">Prophet (Facebook)</div>
                            <div class="model-stats">
                                <div class="model-stat-row">
                                    <span>ƒê·ªô ch√≠nh x√°c:</span>
                                    <span>‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                                <div class="model-stat-row">
                                    <span>T·ªëc ƒë·ªô:</span>
                                    <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                                <div class="model-stat-row">
                                    <span>ƒê·ªô ph·ª©c t·∫°p:</span>
                                    <span>‚≠ê‚≠ê</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary mt-10" style="width: 100%; justify-content: center;" onclick="selectModel('prophet')">
                                Ch·ªçn
                            </button>
                        </div>

                        <div class="model-comparison-card">
                            <div class="model-name">LSTM (Deep Learning)</div>
                            <div class="model-stats">
                                <div class="model-stat-row">
                                    <span>ƒê·ªô ch√≠nh x√°c:</span>
                                    <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                                <div class="model-stat-row">
                                    <span>T·ªëc ƒë·ªô:</span>
                                    <span>‚≠ê‚≠ê‚≠ê</span>
                                </div>
                                <div class="model-stat-row">
                                    <span>ƒê·ªô ph·ª©c t·∫°p:</span>
                                    <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary mt-10" style="width: 100%; justify-content: center;" onclick="selectModel('lstm')">
                                Ch·ªçn
                            </button>
                        </div>

                        <div class="model-comparison-card">
                            <div class="model-name">ARIMA</div>
                            <div class="model-stats">
                                <div class="model-stat-row">
                                    <span>ƒê·ªô ch√≠nh x√°c:</span>
                                    <span>‚≠ê‚≠ê‚≠ê</span>
                                </div>
                                <div class="model-stat-row">
                                    <span>T·ªëc ƒë·ªô:</span>
                                    <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                                </div>
                                <div class="model-stat-row">
                                    <span>ƒê·ªô ph·ª©c t·∫°p:</span>
                                    <span>‚≠ê‚≠ê</span>
                                </div>
                            </div>
                            <button class="btn btn-secondary mt-10" style="width: 100%; justify-content: center;" onclick="selectModel('arima')">
                                Ch·ªçn
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Start Training
        async function startTraining() {
            const trainingSection = document.getElementById('trainingSection');
            const resultsDiv = document.getElementById('trainingResults');
            
            trainingSection.style.display = 'block';
            resultsDiv.classList.add('hidden');
            
            // Reset step styles
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById('step-' + i);
                step.classList.remove('completed', 'active');
            }
            document.getElementById('step-1').classList.add('active');
            
            // Get form values
            const config = {
                mlModel: document.getElementById('mlModel').value,
                dataSource: document.getElementById('dataSource').value,
                trainingDays: document.getElementById('trainingDays').value,
                targetVariable: document.getElementById('targetVariable').value,
                testRatio: document.getElementById('testRatio').value,
                useGPU: document.getElementById('useGPU').checked,
                autoHyperparameter: document.getElementById('autoHyperparameter').checked,
            };

            console.log('Training Config:', config);
            AppUtils.showToast('‚è≥ B·∫Øt ƒë·∫ßu hu·∫•n luy·ªán model...', 'info');

            // Simulate training steps
            const steps = [
                { progress: 15, text: 'T·∫£i d·ªØ li·ªáu t·ª´ MySQL...', stepId: 1 },
                { progress: 35, text: 'Ti·ªÅn x·ª≠ l√Ω & l√†m s·∫°ch d·ªØ li·ªáu...', stepId: 2 },
                { progress: 60, text: 'X√¢y d·ª±ng m√¥ h√¨nh ' + config.mlModel.toUpperCase() + '...', stepId: 3 },
                { progress: 85, text: 'ƒê√°nh gi√° hi·ªáu su·∫•t m√¥ h√¨nh...', stepId: 4 },
                { progress: 100, text: 'L∆∞u m√¥ h√¨nh th√†nh c√¥ng!', stepId: 5 }
            ];

            const startTime = Date.now();

            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 1200));
                
                // Update progress
                const progressFill = document.getElementById('mlProgressFill');
                const statusText = document.getElementById('mlTrainingStatus');
                const percentageSpan = document.getElementById('trainingPercentage');
                
                progressFill.style.width = step.progress + '%';
                statusText.textContent = step.text;
                percentageSpan.textContent = step.progress + '%';

                // Mark step as completed
                markStepAsCompleted(step.stepId);
            }

            // Show results
            setTimeout(() => {
                displayTrainingResults(startTime, config);
                resultsDiv.classList.remove('hidden');
                AppUtils.showToast('‚úì Hu·∫•n luy·ªán m√¥ h√¨nh th√†nh c√¥ng!', 'success');
                
                // Update current model info
                document.getElementById('currentModel').textContent = 
                    config.mlModel.toUpperCase();
                document.getElementById('lastTrainTime').textContent = 
                    new Date().toLocaleString('vi-VN');
                document.getElementById('trainingDataCount').textContent = 
                    (parseInt(config.trainingDays) * 24).toLocaleString('vi-VN') + ' m·∫´u';
            }, 800);
        }

        // Mark step as completed
        function markStepAsCompleted(stepId) {
            const stepElement = document.getElementById('step-' + stepId);
            if (stepElement) {
                stepElement.classList.remove('active');
                stepElement.classList.add('completed');
                
                // Update next step to active (if exists)
                const nextStep = document.getElementById('step-' + (stepId + 1));
                if (nextStep) {
                    nextStep.classList.add('active');
                }
            }
        }

        // Display training results
        function displayTrainingResults(startTime, config) {
            const endTime = Date.now();
            const duration = ((endTime - startTime) / 1000).toFixed(2);
            
            // Simulate random metrics based on model type
            let baseRMSE, baseMAE, baseR2;
            
            switch(config.mlModel) {
                case 'lstm':
                    baseRMSE = 0.25 + Math.random() * 0.2;
                    baseMAE = 0.15 + Math.random() * 0.15;
                    baseR2 = 0.92 + Math.random() * 0.07;
                    break;
                case 'arima':
                    baseRMSE = 0.35 + Math.random() * 0.2;
                    baseMAE = 0.25 + Math.random() * 0.15;
                    baseR2 = 0.85 + Math.random() * 0.1;
                    break;
                default: // prophet
                    baseRMSE = 0.30 + Math.random() * 0.2;
                    baseMAE = 0.20 + Math.random() * 0.15;
                    baseR2 = 0.88 + Math.random() * 0.1;
            }
            
            document.getElementById('resultRMSE').textContent = baseRMSE.toFixed(3) + '¬∞C';
            document.getElementById('resultMAE').textContent = baseMAE.toFixed(3) + '¬∞C';
            document.getElementById('resultR2').textContent = baseR2.toFixed(3);
            document.getElementById('resultTime').textContent = duration + 's';
            
            // Update model accuracy
            document.getElementById('modelAccuracy').textContent = 
                (baseR2 * 100).toFixed(1) + '%';
        }

        // Preview training data
        function previewTrainingData() {
            const dataSource = document.getElementById('dataSource').value;
            const trainingDays = document.getElementById('trainingDays').value;
            const targetVariable = document.getElementById('targetVariable').value;
            
            AppUtils.showToast(
                `üìä Xem tr∆∞·ªõc d·ªØ li·ªáu:\nNgu·ªìn: ${dataSource}\nTh·ªùi gian: ${trainingDays} ng√†y\nBi·∫øn: ${targetVariable}`,
                'info'
            );
        }

        // Validate data
        function validateData() {
            AppUtils.showToast('‚úì D·ªØ li·ªáu h·ª£p l·ªá v√† s·∫µn s√†ng ƒë·ªÉ hu·∫•n luy·ªán!', 'success');
        }

        // Select model
        function selectModel(modelName) {
            document.getElementById('mlModel').value = modelName;
            AppUtils.showToast(`‚úì ƒê√£ ch·ªçn model: ${modelName.toUpperCase()}`, 'success');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Update clock
            setInterval(() => {
                const now = new Date();
                document.getElementById('clockTime').textContent = 
                    now.toLocaleTimeString('vi-VN');
            }, 1000);
        });
    </script>
</body>

</html>
