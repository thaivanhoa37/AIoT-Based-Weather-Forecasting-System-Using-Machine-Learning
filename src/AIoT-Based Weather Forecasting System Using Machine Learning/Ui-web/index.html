<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>T·ªïng quan - AIoT Weather</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">
                <span class="logo-icon">üå§Ô∏è</span>
                <div>
                    <div class="app-title">AIoT Weather</div>
                    <div class="app-subtitle">AIoT-ML</div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üè†</span>
                        <span>T·ªïng quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="charts.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span>Bi·ªÉu ƒë·ªì & Ph√¢n t√≠ch</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="forecast.html" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>D·ª± b√°o (ML)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="ml-training.html" class="nav-link">
                        <span class="nav-icon">üöÄ</span>
                        <span>Hu·∫•n luy·ªán ML</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="mysql.html" class="nav-link">
                        <span class="nav-icon">üíæ</span>
                        <span>Qu·∫£n l√Ω d·ªØ li·ªáu MySQL</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>C·∫•u h√¨nh h·ªá th·ªëng</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
                <h1 class="page-title">T·ªïng quan th·ªùi ti·∫øt</h1>
            </div>
            <div class="topbar-right">
                <div class="clock-display">
                    <span class="clock-time" id="clockTime">00:00:00</span>
                    <span class="clock-label">GMT+7</span>
                </div>
                <div class="status-badge connected" id="mysqlStatus">
                    <span class="status-dot"></span> MySQL: Connected
                </div>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- Current Weather Overview -->
            <section class="section">
                <div class="weather-hero">
                    <div class="hero-content">
                        <div class="current-temp-display">
                            <div class="current-temp" id="currentTemp">--¬∞C</div>
                            <div class="weather-description" id="weatherDesc">ƒêang t·∫£i...</div>
                        </div>
                        <div class="hero-info">
                            <div class="info-item">
                                <span class="info-label">üíß ƒê·ªô ·∫©m</span>
                                <span class="info-value" id="heroHumidity">--%</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">üí® Gi√≥</span>
                                <span class="info-value" id="heroWind">--km/h</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">‚è±Ô∏è √Åp su·∫•t</span>
                                <span class="info-value" id="heroPressure">--hPa</span>
                            </div>
                        </div>
                    </div>
                    <div class="location-info">
                        <span>üìç Qu·∫≠n 9, TP.HCM</span>
                        <span class="last-update" id="lastUpdate">C·∫≠p nh·∫≠t l√∫c --</span>
                    </div>
                </div>
            </section>

            <!-- Real-time IoT Sensor Data -->
            <section class="section">
                <h2 class="section-title">üì° D·ªØ li·ªáu c·∫£m bi·∫øn IoT (Th·ªùi gian th·ª±c)</h2>
                <div class="cards-grid" id="iotDataCards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon temp">üå°Ô∏è</div>
                            <div class="card-label">Nhi·ªát ƒë·ªô</div>
                        </div>
                        <div class="card-value" id="tempValue">--<span class="card-unit">¬∞C</span></div>
                        <div class="card-footer" id="tempTime">ƒêang t·∫£i...</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon humidity">üíß</div>
                            <div class="card-label">ƒê·ªô ·∫©m</div>
                        </div>
                        <div class="card-value" id="humidityValue">--<span class="card-unit">%</span></div>
                        <div class="card-footer" id="humidityTime">ƒêang t·∫£i...</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon pressure">‚è±Ô∏è</div>
                            <div class="card-label">√Åp su·∫•t</div>
                        </div>
                        <div class="card-value" id="pressureValue">--<span class="card-unit">hPa</span></div>
                        <div class="card-footer" id="pressureTime">ƒêang t·∫£i...</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon co2">üí®</div>
                            <div class="card-label">CO‚ÇÇ</div>
                        </div>
                        <div class="card-value" id="co2Value">--<span class="card-unit">ppm</span></div>
                        <div class="card-footer" id="co2Time">ƒêang t·∫£i...</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon dust">üå´Ô∏è</div>
                            <div class="card-label">B·ª•i m·ªãn</div>
                        </div>
                        <div class="card-value" id="dustValue">--<span class="card-unit">¬µg/m¬≥</span></div>
                        <div class="card-footer" id="dustTime">ƒêang t·∫£i...</div>
                    </div>
                </div>
                <div class="text-center mt-10">
                    <button class="btn btn-primary" onclick="loadRealtimeData()">
                        üîÑ C·∫≠p nh·∫≠t d·ªØ li·ªáu
                    </button>
                </div>
            </section>

            <!-- Weather API Data -->
            <section class="section">
                <h2 class="section-title">üåç D·ªØ li·ªáu t·ª´ API Th·ªùi ti·∫øt</h2>
                <div class="cards-grid" id="weatherApiCards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon wind">üå¨Ô∏è</div>
                            <div class="card-label">T·ªëc ƒë·ªô gi√≥</div>
                        </div>
                        <div class="card-value" id="windSpeedValue">--<span class="card-unit">km/h</span></div>
                        <div class="card-footer">Gi√≥</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon rain">üåßÔ∏è</div>
                            <div class="card-label">L∆∞·ª£ng m∆∞a</div>
                        </div>
                        <div class="card-value" id="rainfallValue">--<span class="card-unit">mm</span></div>
                        <div class="card-footer">M∆∞a</div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-icon uv">‚òÄÔ∏è</div>
                            <div class="card-label">Ch·ªâ s·ªë UV</div>
                        </div>
                        <div class="card-value" id="uvValue">--</div>
                        <div class="card-footer" id="uvLevel">--</div>
                    </div>
                </div>
            </section>

            <!-- 7-Day Weather Forecast -->
            <section class="section">
                <h2 class="section-title">üìÖ D·ª± b√°o 7 ng√†y</h2>
                <p class="section-subtitle">D·ª± b√°o th·ªùi ti·∫øt trong 7 ng√†y t·ªõi t·ª´ API th·ªùi ti·∫øt</p>
                <div class="forecast-grid-7day" id="forecast7DayGrid">
                    <!-- Will be populated by JavaScript -->
                </div>
            </section>

            <!-- Today Hourly Forecast -->
            <section class="section">
                <h2 class="section-title">üìà D·ª± b√°o theo gi·ªù (24 gi·ªù)</h2>
                <p class="section-subtitle">D·ª± b√°o th·ªùi ti·∫øt chi ti·∫øt t·ª´ng gi·ªù trong 24 gi·ªù t·ªõi</p>
                <div class="forecast-scroll-container">
                    <div class="forecast-grid-hourly" id="forecastHourlyGrid">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </section>

            <!-- System Status -->
            <section class="section">
                <h2 class="section-title">‚öôÔ∏è Tr·∫°ng th√°i h·ªá th·ªëng</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üì°</div>
                        <div class="stat-label">C·∫£m bi·∫øn ho·∫°t ƒë·ªông</div>
                        <div class="stat-details">
                            <div class="stat-row">
                                <span class="stat-label-small">S·ªë l∆∞·ª£ng</span>
                                <span class="stat-value-small" id="activeSensors">5</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-label">B·∫£n ghi d·ªØ li·ªáu</div>
                        <div class="stat-details">
                            <div class="stat-row">
                                <span class="stat-label-small">H√¥m nay</span>
                                <span class="stat-value-small" id="recordsToday">--</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è∞</div>
                        <div class="stat-label">C·∫≠p nh·∫≠t l·∫ßn cu·ªëi</div>
                        <div class="stat-details">
                            <div class="stat-row">
                                <span class="stat-label-small">Th·ªùi gian</span>
                                <span class="stat-value-small" id="lastDataTime">--</span>
                            </div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úì</div>
                        <div class="stat-label">Tr·∫°ng th√°i</div>
                        <div class="stat-details">
                            <div class="stat-row">
                                <span class="stat-label-small">H·ªá th·ªëng</span>
                                <span class="stat-value-small" style="color: #48bb78;" id="systemStatus">Ho·∫°t ƒë·ªông</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Page-specific JavaScript
        let trendData = {
            temperature: [],
            humidity: [],
            co2: [],
            dust: []
        };

        // Generate 7-day forecast data
        function generateForecast7Day() {
            const forecast = [];
            const weatherConditions = ['N·∫Øng', 'M√¢y', 'M∆∞a', 'N·∫Øng', 'M√¢y', 'M∆∞a', 'N·∫Øng'];
            const icons = ['‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚òÄÔ∏è'];
            
            // Get today's date
            const today = new Date();
            const currentDayOfWeek = today.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday
            
            // Calculate days until next Monday (1)
            let daysUntilMonday = (1 - currentDayOfWeek + 7) % 7;
            if (daysUntilMonday === 0) {
                daysUntilMonday = 7; // If today is Monday, start from next Monday
            }
            
            // Start from next Monday
            const startDate = new Date(today);
            startDate.setDate(today.getDate() + daysUntilMonday);
            
            // Generate 7 days starting from Monday
            for (let i = 0; i < 7; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                // Get day of week name (th·ª© 2, th·ª© 3, etc.)
                const dayOfWeek = date.getDay();
                const dayNames = ['Ch·ªß nh·∫≠t', 'Th·ª© 2', 'Th·ª© 3', 'Th·ª© 4', 'Th·ª© 5', 'Th·ª© 6', 'Th·ª© 7'];
                const dayName = dayNames[dayOfWeek];
                
                // Format as "Th·ª© 2, 05/12"
                const monthDay = date.toLocaleDateString('vi-VN', { month: '2-digit', day: '2-digit' });
                
                forecast.push({
                    date: `${dayName}, ${monthDay}`,
                    condition: weatherConditions[i],
                    icon: icons[i],
                    tempMax: 28 + Math.random() * 5,
                    tempMin: 22 + Math.random() * 3,
                    humidity: 65 + Math.random() * 20,
                    windSpeed: 10 + Math.random() * 8,
                    rainChance: Math.random() * 100
                });
            }
            return forecast;
        }

        // Generate hourly forecast for today
        function generateForecastHourly() {
            const forecast = [];
            const conditions = ['N·∫Øng', 'M√¢y', 'M∆∞a nh·∫π', 'N·∫Øng'];
            const icons = ['‚òÄÔ∏è', '‚òÅÔ∏è', 'üåßÔ∏è', '‚òÄÔ∏è'];
            
            for (let i = 0; i < 24; i++) {
                const time = new Date();
                time.setHours(i);
                
                forecast.push({
                    time: time.toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }),
                    hour: i,
                    condition: conditions[Math.floor(Math.random() * conditions.length)],
                    icon: icons[Math.floor(Math.random() * icons.length)],
                    temp: 24 + Math.random() * 6,
                    humidity: 60 + Math.random() * 30,
                    windSpeed: 8 + Math.random() * 10,
                    rainChance: Math.random() * 100
                });
            }
            return forecast;
        }

        // Display 7-day forecast
        function displayForecast7Day() {
            const forecast = generateForecast7Day();
            const grid = document.getElementById('forecast7DayGrid');
            grid.innerHTML = '';

            forecast.forEach(day => {
                const card = document.createElement('div');
                card.className = 'forecast-card-7day';
                card.innerHTML = `
                    <div class="forecast-date">${day.date}</div>
                    <div class="forecast-icon" style="font-size: 32px;">${day.icon}</div>
                    <div class="forecast-condition">${day.condition}</div>
                    <div class="forecast-temp">
                        <span class="temp-max">${day.tempMax.toFixed(0)}¬∞</span>
                        <span class="temp-min">${day.tempMin.toFixed(0)}¬∞</span>
                    </div>
                    <div class="forecast-details">
                        <span>üíß ${day.humidity.toFixed(0)}%</span>
                        <span>üí® ${day.windSpeed.toFixed(0)}km/h</span>
                    </div>
                    <div class="forecast-rain">‚òî ${day.rainChance.toFixed(0)}%</div>
                `;
                grid.appendChild(card);
            });
        }

        // Display hourly forecast
        function displayForecastHourly() {
            const forecast = generateForecastHourly();
            const grid = document.getElementById('forecastHourlyGrid');
            grid.innerHTML = '';

            // Show all 24 hours
            forecast.forEach((hour, index) => {
                const card = document.createElement('div');
                card.className = 'forecast-card-hourly';
                // Highlight current hour
                if (index === new Date().getHours()) {
                    card.classList.add('current-hour');
                }
                card.innerHTML = `
                    <div class="forecast-hour">${hour.time}</div>
                    <div class="forecast-icon" style="font-size: 28px;">${hour.icon}</div>
                    <div class="forecast-temp-main">${hour.temp.toFixed(0)}¬∞C</div>
                    <div class="forecast-condition-small">${hour.condition}</div>
                    <div class="forecast-details-small">
                        <span>üíß ${hour.humidity.toFixed(0)}%</span>
                    </div>
                    <div class="forecast-details-small">
                        <span>üí® ${hour.windSpeed.toFixed(0)}km/h</span>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Add smooth scrolling with scroll buttons
            addScrollButtons();
        }

        // Add scroll buttons for hourly forecast
        function addScrollButtons() {
            const container = document.querySelector('.forecast-scroll-container');
            if (!container) return;

            // Remove existing buttons if any
            const existingBtn = container.querySelectorAll('.scroll-btn');
            existingBtn.forEach(btn => btn.remove());

            // Create scroll buttons
            const leftBtn = document.createElement('button');
            leftBtn.className = 'scroll-btn scroll-left';
            leftBtn.innerHTML = '‚ùÆ';
            leftBtn.onclick = () => {
                const grid = document.getElementById('forecastHourlyGrid');
                grid.parentElement.scrollBy({ left: -300, behavior: 'smooth' });
            };

            const rightBtn = document.createElement('button');
            rightBtn.className = 'scroll-btn scroll-right';
            rightBtn.innerHTML = '‚ùØ';
            rightBtn.onclick = () => {
                const grid = document.getElementById('forecastHourlyGrid');
                grid.parentElement.scrollBy({ left: 300, behavior: 'smooth' });
            };

            container.appendChild(leftBtn);
            container.appendChild(rightBtn);
        }

        // Load realtime data
        async function loadRealtimeData() {
            const cards = document.getElementById('iotDataCards');
            const loading = AppUtils.showLoading(cards);

            try {
                const data = await AppUtils.fetchRealtimeData();

                // Update hero section
                document.getElementById('currentTemp').textContent = `${data.temperature}¬∞C`;
                document.getElementById('weatherDesc').textContent = 'Th·ªùi ti·∫øt hi·ªán t·∫°i';
                document.getElementById('heroHumidity').textContent = `${data.humidity}%`;
                document.getElementById('heroWind').textContent = `${data.windSpeed}km/h`;
                document.getElementById('heroPressure').textContent = `${data.pressure}hPa`;
                document.getElementById('lastUpdate').textContent = `C·∫≠p nh·∫≠t l√∫c ${data.timestamp}`;

                // Update IoT data cards
                document.getElementById('tempValue').innerHTML = `${data.temperature}<span class="card-unit">¬∞C</span>`;
                document.getElementById('humidityValue').innerHTML = `${data.humidity}<span class="card-unit">%</span>`;
                document.getElementById('pressureValue').innerHTML = `${data.pressure}<span class="card-unit">hPa</span>`;
                document.getElementById('co2Value').innerHTML = `${data.co2}<span class="card-unit">ppm</span>`;
                document.getElementById('dustValue').innerHTML = `${data.dust}<span class="card-unit">¬µg/m¬≥</span>`;

                // Update timestamps
                const timestamp = `C·∫≠p nh·∫≠t: ${data.timestamp}`;
                document.getElementById('tempTime').textContent = timestamp;
                document.getElementById('humidityTime').textContent = timestamp;
                document.getElementById('pressureTime').textContent = timestamp;
                document.getElementById('co2Time').textContent = timestamp;
                document.getElementById('dustTime').textContent = timestamp;

                // Update weather API data
                document.getElementById('windSpeedValue').innerHTML = `${data.windSpeed}<span class="card-unit">km/h</span>`;
                document.getElementById('rainfallValue').innerHTML = `${data.rainfall}<span class="card-unit">mm</span>`;
                document.getElementById('uvValue').textContent = data.uvIndex;
                document.getElementById('uvLevel').textContent = AppUtils.getUVLevel(data.uvIndex);

                // Update system status
                document.getElementById('lastDataTime').textContent = data.timestamp;
                document.getElementById('recordsToday').textContent = Math.floor(Math.random() * 50) + 100;

                AppUtils.showToast('ƒê√£ c·∫≠p nh·∫≠t d·ªØ li·ªáu th√†nh c√¥ng', 'success');
            } catch (error) {
                AppUtils.showToast(error.message, 'error');
            } finally {
                AppUtils.hideLoading(loading);
            }
        }

        // Load trend charts
        async function loadTrendCharts() {
            // Trend charts removed
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            loadRealtimeData();
            displayForecast7Day();
            displayForecastHourly();

            // Auto-refresh every 30 seconds
            setInterval(loadRealtimeData, 30000);
        });
    </script>
</body>

</html>