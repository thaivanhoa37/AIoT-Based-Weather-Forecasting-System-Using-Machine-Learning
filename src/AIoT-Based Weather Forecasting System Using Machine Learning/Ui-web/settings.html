<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫•u h√¨nh h·ªá th·ªëng - AIoT Weather</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">
                <span class="logo-icon">üå§Ô∏è</span>
                <div>
                    <div class="app-title">AIoT Weather</div>
                    <div class="app-subtitle">AIoT-ML</div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üè†</span>
                        <span>T·ªïng quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="charts.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span>Bi·ªÉu ƒë·ªì & Ph√¢n t√≠ch</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="forecast.html" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>D·ª± b√°o (ML)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="ml-training.html" class="nav-link">
                        <span class="nav-icon">üöÄ</span>
                        <span>Hu·∫•n luy·ªán ML</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="mysql.html" class="nav-link">
                        <span class="nav-icon">üíæ</span>
                        <span>Qu·∫£n l√Ω d·ªØ li·ªáu MySQL</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>C·∫•u h√¨nh h·ªá th·ªëng</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
                <h1 class="page-title">C·∫•u h√¨nh h·ªá th·ªëng</h1>
            </div>
            <div class="topbar-right">
                <div class="clock-display">
                    <span class="clock-time" id="clockTime">00:00:00</span>
                    <span class="clock-label">GMT+7</span>
                </div>
                <div class="status-badge connected" id="mysqlStatus">
                    <span class="status-dot"></span> MySQL: Connected
                </div>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- IoT Station Configuration -->
            <section class="section">
                <h2 class="section-title">C·∫•u h√¨nh tr·∫°m IoT</h2>
                <div class="card">
                    <form id="iotConfigForm" onsubmit="saveIoTConfig(event)">
                        <div class="form-group">
                            <label class="form-label">T√™n tr·∫°m</label>
                            <input type="text" class="form-input" id="stationName"
                                value="Tr·∫°m t·∫ßm C√¥ng ngh·ªá cao, Qu·∫≠n 9">
                        </div>

                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ID Node 1</label>
                                <input type="text" class="form-input" id="node1Id" value="NODE_001">
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ID Node 2</label>
                                <input type="text" class="form-input" id="node2Id" value="NODE_002">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Chu k·ª≥ g·ª≠i d·ªØ li·ªáu (gi√¢y)</label>
                            <input type="number" class="form-input" id="dataInterval" value="60" min="10" max="3600">
                        </div>

                        <h3 class="section-subtitle mt-20">Ng∆∞·ª°ng c·∫£nh b√°o</h3>

                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">Nhi·ªát ƒë·ªô t·ªëi ƒëa (¬∞C)</label>
                                <input type="number" class="form-input" id="maxTemp" value="40" step="0.1">
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ƒê·ªô ·∫©m t·ªëi ƒëa (%)</label>
                                <input type="number" class="form-input" id="maxHumidity" value="90">
                            </div>
                        </div>

                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">CO‚ÇÇ t·ªëi ƒëa (ppm)</label>
                                <input type="number" class="form-input" id="maxCO2" value="1000">
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">B·ª•i m·ªãn t·ªëi ƒëa (¬µg/m¬≥)</label>
                                <input type="number" class="form-input" id="maxDust" value="50" step="0.1">
                            </div>
                        </div>

                        <div class="form-checkbox mt-10">
                            <input type="checkbox" id="enableAlerts" checked>
                            <label for="enableAlerts">G·ª≠i c·∫£nh b√°o khi v∆∞·ª£t ng∆∞·ª°ng</label>
                        </div>

                        <div class="mt-20">
                            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh IoT</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Weather API Configuration -->
            <section class="section">
                <h2 class="section-title">C·∫•u h√¨nh API Th·ªùi ti·∫øt</h2>
                <div class="card">
                    <form id="apiConfigForm" onsubmit="saveAPIConfig(event)">
                        <div class="form-group">
                            <label class="form-label">API Key (OpenWeatherMap)</label>
                            <input type="password" class="form-input" id="apiKey" value="your_api_key_here"
                                placeholder="Nh·∫≠p API key...">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Th√†nh ph·ªë ho·∫∑c t·ªça ƒë·ªô</label>
                            <input type="text" class="form-input" id="location" value="Ho Chi Minh City, VN">
                            <small style="color: var(--text-secondary); font-size: 12px;">
                                V√≠ d·ª•: "Hanoi, VN" ho·∫∑c "lat=10.8231&lon=106.6297"
                            </small>
                        </div>

                        <div class="mt-20">
                            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh API</button>
                            <button type="button" class="btn btn-secondary" onclick="testAPIConnection()">
                                üîå Ki·ªÉm tra k·∫øt n·ªëi API
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- ML Configuration -->
            <section class="section">
                <h2 class="section-title">‚öôÔ∏è C·∫•u h√¨nh v√† Hu·∫•n luy·ªán Model</h2>
                
                <!-- ML Configuration Card -->
                <div class="card">
                    <h3 class="section-subtitle">C·∫•u h√¨nh Model</h3>
                    <form id="mlConfigForm" onsubmit="saveMLConfig(event)">
                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ü§ñ Model d·ª± b√°o</label>
                                <select class="form-select" id="mlModel">
                                    <option value="prophet" selected>Prophet (Facebook)</option>
                                    <option value="lstm">LSTM (Deep Learning)</option>
                                    <option value="arima">ARIMA</option>
                                </select>
                                <small style="color: var(--text-secondary); font-size: 11px; margin-top: 5px; display: block;">
                                    Ch·ªçn model ph√π h·ª£p v·ªõi d·ªØ li·ªáu c·ªßa b·∫°n
                                </small>
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">‚è∞ L·ªãch train t·ª± ƒë·ªông</label>
                                <select class="form-select" id="trainSchedule">
                                    <option value="6">M·ªói 6 gi·ªù</option>
                                    <option value="12" selected>M·ªói 12 gi·ªù</option>
                                    <option value="24">M·ªói 24 gi·ªù</option>
                                    <option value="0">Kh√¥ng t·ª± ƒë·ªông</option>
                                </select>
                                <small style="color: var(--text-secondary); font-size: 11px; margin-top: 5px; display: block;">
                                    T·∫ßn su·∫•t t·ª± ƒë·ªông train l·∫°i model
                                </small>
                            </div>
                        </div>

                        <div class="mt-20">
                            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh ML</button>
                        </div>
                    </form>
                </div>

                <!-- Model Status Card -->
                <div class="card mt-20">
                    <h3 class="section-subtitle">üìä Tr·∫°ng th√°i Model hi·ªán t·∫°i</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                        <div class="stat-info-box">
                            <div class="stat-info-label">Model ƒëang d√πng</div>
                            <div class="stat-info-value" id="currentModel">Prophet</div>
                        </div>
                        <div class="stat-info-box">
                            <div class="stat-info-label">L·∫ßn train g·∫ßn nh·∫•t</div>
                            <div class="stat-info-value" id="lastTrainTime">--</div>
                        </div>
                        <div class="stat-info-box">
                            <div class="stat-info-label">D·ªØ li·ªáu ƒë√£ d√πng</div>
                            <div class="stat-info-value" id="trainingDataCount">0</div>
                        </div>
                        <div class="stat-info-box">
                            <div class="stat-info-label">ƒê·ªô ch√≠nh x√°c (RMSE)</div>
                            <div class="stat-info-value" id="modelAccuracy">--</div>
                        </div>
                    </div>
                </div>

                <!-- Training Section Card -->
                <div class="card mt-20">
                    <h3 class="section-subtitle">üöÄ Hu·∫•n luy·ªán Model</h3>
                    
                    <div class="info-panel">
                        <div class="info-panel-content">
                            <strong>‚ÑπÔ∏è Th√¥ng tin:</strong> Qu√° tr√¨nh hu·∫•n luy·ªán s·∫Ω s·ª≠ d·ª•ng d·ªØ li·ªáu t·ª´ MySQL, ti·ªÅn x·ª≠ l√Ω, 
                            x√¢y d·ª±ng model v√† ƒë√°nh gi√° hi·ªáu su·∫•t. Th·ªùi gian c√≥ th·ªÉ t·ª´ v√†i ph√∫t ƒë·∫øn v√†i gi·ªù t√πy v√†o dung l∆∞·ª£ng d·ªØ li·ªáu.
                        </div>
                    </div>

                    <div class="training-options mt-20">
                        <div class="form-group">
                            <label class="form-label">üìÅ Ngu·ªìn d·ªØ li·ªáu</label>
                            <select class="form-select" id="dataSource">
                                <option value="mysql" selected>MySQL Local</option>
                                <option value="firebase">Firebase Realtime Database</option>
                                <option value="csv">CSV File</option>
                            </select>
                        </div>

                        <div class="filter-row mt-10">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üìÖ Kho·∫£ng th·ªùi gian d·ªØ li·ªáu</label>
                                <input type="number" class="form-input" id="trainingDays" value="30" min="7" max="365">
                                <small style="color: var(--text-secondary); font-size: 11px; margin-top: 5px; display: block;">
                                    S·ªë ng√†y d·ªØ li·ªáu qu√° kh·ª©
                                </small>
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üéØ Bi·∫øn d·ª± b√°o</label>
                                <select class="form-select" id="targetVariable">
                                    <option value="temp" selected>Nhi·ªát ƒë·ªô (¬∞C)</option>
                                    <option value="humidity">ƒê·ªô ·∫©m (%)</option>
                                    <option value="pressure">√Åp su·∫•t (hPa)</option>
                                    <option value="all">T·∫•t c·∫£ bi·∫øn</option>
                                </select>
                            </div>
                        </div>

                        <div class="filter-row mt-10">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">üîß T·ª∑ l·ªá train/test</label>
                                <select class="form-select" id="testRatio">
                                    <option value="0.2" selected>80/20 (Khuy·∫øn ngh·ªã)</option>
                                    <option value="0.15">85/15</option>
                                    <option value="0.25">75/25</option>
                                </select>
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">‚ö° Kh·∫£ nƒÉng GPU</label>
                                <div style="display: flex; gap: 10px; margin-top: 10px; align-items: center;">
                                    <input type="checkbox" id="useGPU">
                                    <label for="useGPU" style="margin: 0;">S·ª≠ d·ª•ng GPU n·∫øu c√≥</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-20" style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button type="button" class="btn btn-primary" onclick="startTraining()" style="flex: 1; min-width: 200px;">
                            üöÄ B·∫Øt ƒë·∫ßu Train Model
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="previewTrainingData()" style="flex: 1; min-width: 200px;">
                            üëÅÔ∏è Xem tr∆∞·ªõc d·ªØ li·ªáu
                        </button>
                    </div>

                    <!-- Training Progress Section -->
                    <div id="mlTrainingProgress" class="hidden mt-20">
                        <h4 style="margin-bottom: 15px; color: var(--text);">üìà Ti·∫øn tr√¨nh hu·∫•n luy·ªán</h4>
                        
                        <div class="progress-container">
                            <div class="progress-bar-large">
                                <div class="progress-fill-large" id="mlProgressFill" style="width: 0%;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                                <p id="mlTrainingStatus" style="font-size: 14px; font-weight: 600; color: var(--text); margin: 0;">
                                    ƒêang chu·∫©n b·ªã...
                                </p>
                                <span id="trainingPercentage" style="font-size: 14px; font-weight: 600; color: var(--accent);">0%</span>
                            </div>
                        </div>

                        <div class="training-steps mt-20">
                            <div class="training-step" id="step-1">
                                <span class="step-icon">‚è≥</span>
                                <span class="step-label">T·∫£i d·ªØ li·ªáu t·ª´ MySQL</span>
                                <span class="step-status"></span>
                            </div>
                            <div class="training-step" id="step-2">
                                <span class="step-icon">‚è≥</span>
                                <span class="step-label">Ti·ªÅn x·ª≠ l√Ω & l√†m s·∫°ch d·ªØ li·ªáu</span>
                                <span class="step-status"></span>
                            </div>
                            <div class="training-step" id="step-3">
                                <span class="step-icon">‚è≥</span>
                                <span class="step-label">X√¢y d·ª±ng model</span>
                                <span class="step-status"></span>
                            </div>
                            <div class="training-step" id="step-4">
                                <span class="step-icon">‚è≥</span>
                                <span class="step-label">ƒê√°nh gi√° hi·ªáu su·∫•t</span>
                                <span class="step-status"></span>
                            </div>
                            <div class="training-step" id="step-5">
                                <span class="step-icon">‚è≥</span>
                                <span class="step-label">L∆∞u model</span>
                                <span class="step-status"></span>
                            </div>
                        </div>

                        <div id="trainingResults" class="hidden mt-20">
                            <h4 style="margin-bottom: 15px; color: var(--text);">üìã K·∫øt qu·∫£ hu·∫•n luy·ªán</h4>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                                <div class="result-box">
                                    <div class="result-label">RMSE</div>
                                    <div class="result-value" id="resultRMSE">--</div>
                                </div>
                                <div class="result-box">
                                    <div class="result-label">MAE</div>
                                    <div class="result-value" id="resultMAE">--</div>
                                </div>
                                <div class="result-box">
                                    <div class="result-label">R¬≤ Score</div>
                                    <div class="result-value" id="resultR2">--</div>
                                </div>
                                <div class="result-box">
                                    <div class="result-label">Th·ªùi gian</div>
                                    <div class="result-value" id="resultTime">--</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- UI Preferences -->
            <section class="section">
                <h2 class="section-title">Giao di·ªán & h·ªá th·ªëng</h2>
                <div class="card">
                    <div class="form-group">
                        <label class="form-label">Giao di·ªán</label>
                        <div class="form-checkbox">
                            <input type="checkbox" id="darkModeToggle">
                            <label for="darkModeToggle">Ch·∫ø ƒë·ªô t·ªëi (Dark Mode)</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="sidebarToggle" checked>
                            <label for="sidebarToggle">Hi·ªÉn th·ªã sidebar m·∫∑c ƒë·ªãnh</label>
                        </div>
                    </div>

                    <h3 class="section-subtitle mt-20">Th√¥ng tin Raspberry Pi</h3>
                    <div class="info-panel">
                        <div class="info-panel-content">
                            <div style="margin-bottom: 8px;">
                                <strong>Local IP:</strong> 192.168.1.100
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>Tr·∫°ng th√°i server:</strong> <span style="color: var(--accent);">‚úì ƒêang
                                    ch·∫°y</span>
                            </div>
                            <div>
                                <strong>H·ªá ƒëi·ªÅu h√†nh:</strong> Raspberry Pi OS (Debian)
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Save IoT Configuration
        function saveIoTConfig(event) {
            event.preventDefault();

            const config = {
                stationName: document.getElementById('stationName').value,
                node1Id: document.getElementById('node1Id').value,
                node2Id: document.getElementById('node2Id').value,
                dataInterval: document.getElementById('dataInterval').value,
                maxTemp: document.getElementById('maxTemp').value,
                maxHumidity: document.getElementById('maxHumidity').value,
                maxCO2: document.getElementById('maxCO2').value,
                maxDust: document.getElementById('maxDust').value,
                enableAlerts: document.getElementById('enableAlerts').checked,
            };

            console.log('IoT Config:', config);
            AppUtils.showToast('ƒê√£ l∆∞u c·∫•u h√¨nh tr·∫°m IoT th√†nh c√¥ng', 'success');
        }

        // Save API Configuration
        function saveAPIConfig(event) {
            event.preventDefault();

            const config = {
                apiKey: document.getElementById('apiKey').value,
                location: document.getElementById('location').value,
            };

            console.log('API Config:', config);
            AppUtils.showToast('ƒê√£ l∆∞u c·∫•u h√¨nh API th√†nh c√¥ng', 'success');
        }

        // Test API Connection
        async function testAPIConnection() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> ƒêang ki·ªÉm tra...';

            await new Promise(resolve => setTimeout(resolve, 1500));

            btn.disabled = false;
            btn.innerHTML = 'üîå Ki·ªÉm tra k·∫øt n·ªëi API';
            AppUtils.showToast('K·∫øt n·ªëi API th√†nh c√¥ng (gi·∫£ l·∫≠p)', 'success');
        }

        // Save ML Configuration
        function saveMLConfig(event) {
            event.preventDefault();

            const config = {
                mlModel: document.getElementById('mlModel').value,
                trainSchedule: document.getElementById('trainSchedule').value,
            };

            console.log('ML Config:', config);
            AppUtils.showToast('ƒê√£ l∆∞u c·∫•u h√¨nh ML th√†nh c√¥ng', 'success');
        }

        // Start Training
        async function startTraining() {
            const progressDiv = document.getElementById('mlTrainingProgress');
            const resultsDiv = document.getElementById('trainingResults');
            
            progressDiv.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            
            // Get form values
            const config = {
                dataSource: document.getElementById('dataSource').value,
                trainingDays: document.getElementById('trainingDays').value,
                targetVariable: document.getElementById('targetVariable').value,
                testRatio: document.getElementById('testRatio').value,
                useGPU: document.getElementById('useGPU').checked,
                model: document.getElementById('mlModel').value,
            };

            console.log('Training Config:', config);

            // Simulate training steps
            const steps = [
                { progress: 15, text: 'T·∫£i d·ªØ li·ªáu t·ª´ MySQL...', stepId: 1 },
                { progress: 35, text: 'Ti·ªÅn x·ª≠ l√Ω & l√†m s·∫°ch d·ªØ li·ªáu...', stepId: 2 },
                { progress: 60, text: 'X√¢y d·ª±ng model ' + document.getElementById('mlModel').value + '...', stepId: 3 },
                { progress: 85, text: 'ƒê√°nh gi√° hi·ªáu su·∫•t model...', stepId: 4 },
                { progress: 100, text: 'L∆∞u model th√†nh c√¥ng!', stepId: 5 }
            ];

            let currentStep = 0;
            const startTime = Date.now();

            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 1200));
                
                // Update progress
                const progressFill = document.getElementById('mlProgressFill');
                const statusText = document.getElementById('mlTrainingStatus');
                const percentageSpan = document.querySelector('#trainingPercentage');
                
                progressFill.style.width = step.progress + '%';
                statusText.textContent = step.text;
                percentageSpan.textContent = step.progress + '%';

                // Mark step as completed
                markStepAsCompleted(step.stepId);
                
                currentStep++;
            }

            // Show results
            setTimeout(() => {
                displayTrainingResults(startTime);
                resultsDiv.classList.remove('hidden');
                AppUtils.showToast('‚úì Hu·∫•n luy·ªán model th√†nh c√¥ng!', 'success');
                
                // Update current model info
                document.getElementById('currentModel').textContent = 
                    document.getElementById('mlModel').value.toUpperCase();
                document.getElementById('lastTrainTime').textContent = 
                    new Date().toLocaleString('vi-VN');
                document.getElementById('trainingDataCount').textContent = 
                    (parseInt(config.trainingDays) * 24).toLocaleString('vi-VN');
            }, 800);
        }

        // Mark step as completed
        function markStepAsCompleted(stepId) {
            const stepElement = document.getElementById('step-' + stepId);
            if (stepElement) {
                stepElement.classList.remove('active');
                stepElement.classList.add('completed');
                
                // Update next step to active (if exists)
                const nextStep = document.getElementById('step-' + (stepId + 1));
                if (nextStep) {
                    nextStep.classList.add('active');
                }
            }
        }

        // Display training results
        function displayTrainingResults(startTime) {
            const endTime = Date.now();
            const duration = ((endTime - startTime) / 1000).toFixed(2);
            
            // Simulate random metrics
            const rmse = (Math.random() * 0.5 + 0.3).toFixed(3);
            const mae = (Math.random() * 0.4 + 0.2).toFixed(3);
            const r2 = (Math.random() * 0.15 + 0.85).toFixed(3);
            
            document.getElementById('resultRMSE').textContent = rmse + '¬∞C';
            document.getElementById('resultMAE').textContent = mae + '¬∞C';
            document.getElementById('resultR2').textContent = r2;
            document.getElementById('resultTime').textContent = duration + 's';
            
            // Update model accuracy
            document.getElementById('modelAccuracy').textContent = 
                (parseFloat(r2) * 100).toFixed(1) + '%';
        }

        // Preview training data
        function previewTrainingData() {
            const dataSource = document.getElementById('dataSource').value;
            const trainingDays = document.getElementById('trainingDays').value;
            const targetVariable = document.getElementById('targetVariable').value;
            
            AppUtils.showToast(
                `üìä Xem tr∆∞·ªõc d·ªØ li·ªáu:\n` +
                `Ngu·ªìn: ${dataSource}\n` +
                `Th·ªùi gian: ${trainingDays} ng√†y g·∫ßn nh·∫•t\n` +
                `Bi·∫øn: ${targetVariable}`,
                'info'
            );
            
            // In a real implementation, this would open a modal with data preview
            console.log('Preview data - Source:', dataSource, 'Days:', trainingDays, 'Target:', targetVariable);
        }

        // Manual Train (legacy)
        async function manualTrain() {
            const progressDiv = document.getElementById('mlTrainingProgress');
            const progressFill = document.getElementById('mlProgressFill');
            const statusText = document.getElementById('mlTrainingStatus');

            progressDiv.classList.remove('hidden');
            progressFill.style.width = '0%';
            statusText.textContent = 'ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...';

            const steps = [
                { progress: 20, text: 'ƒêang t·∫£i d·ªØ li·ªáu t·ª´ MySQL...' },
                { progress: 40, text: 'ƒêang ti·ªÅn x·ª≠ l√Ω d·ªØ li·ªáu...' },
                { progress: 60, text: 'ƒêang train model...' },
                { progress: 80, text: 'ƒêang ƒë√°nh gi√° model...' },
                { progress: 100, text: 'Ho√†n th√†nh!' }
            ];

            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 800));
                progressFill.style.width = step.progress + '%';
                statusText.textContent = step.text;
            }

            setTimeout(() => {
                progressDiv.classList.add('hidden');
                AppUtils.showToast('Train model th√†nh c√¥ng! (gi·∫£ l·∫≠p)', 'success');
            }, 1000);
        }

        // Sync UI preferences with current state
        function syncUIPreferences() {
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('darkModeToggle').checked = isDark;

            const sidebarOpen = !document.getElementById('sidebar').classList.contains('collapsed');
            document.getElementById('sidebarToggle').checked = sidebarOpen;

            // Listen for changes
            document.getElementById('darkModeToggle').addEventListener('change', (e) => {
                if (e.target.checked !== isDark) {
                    document.getElementById('themeToggle').click();
                }
            });

            document.getElementById('sidebarToggle').addEventListener('change', (e) => {
                localStorage.setItem('sidebarOpen', e.target.checked);
                AppUtils.showToast('C√†i ƒë·∫∑t sidebar s·∫Ω √°p d·ª•ng khi t·∫£i l·∫°i trang', 'success');
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            syncUIPreferences();
        });
    </script>
</body>

</html>