<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C·∫•u h√¨nh h·ªá th·ªëng - AIoT Weather</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="app-logo">
                <span class="logo-icon">üå§Ô∏è</span>
                <div>
                    <div class="app-title">AIoT Weather</div>
                    <div class="app-subtitle">AIoT-ML</div>
                </div>
            </div>
        </div>
        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="index.html" class="nav-link">
                        <span class="nav-icon">üè†</span>
                        <span>T·ªïng quan</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="charts.html" class="nav-link">
                        <span class="nav-icon">üìä</span>
                        <span>Bi·ªÉu ƒë·ªì & Ph√¢n t√≠ch</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="forecast.html" class="nav-link">
                        <span class="nav-icon">ü§ñ</span>
                        <span>D·ª± b√°o (ML)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="mysql.html" class="nav-link">
                        <span class="nav-icon">üíæ</span>
                        <span>Qu·∫£n l√Ω d·ªØ li·ªáu MySQL</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <span class="nav-icon">‚öôÔ∏è</span>
                        <span>C·∫•u h√¨nh h·ªá th·ªëng</span>
                    </a>
                </li>
            </ul>
        </nav>
    </aside>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="hamburger-btn" id="hamburgerBtn">‚ò∞</button>
                <h1 class="page-title">C·∫•u h√¨nh h·ªá th·ªëng</h1>
            </div>
            <div class="topbar-right">
                <div class="clock-display">
                    <span class="clock-time" id="clockTime">00:00:00</span>
                    <span class="clock-label">GMT+7</span>
                </div>
                <div class="status-badge connected" id="mysqlStatus">
                    <span class="status-dot"></span> MySQL: Connected
                </div>
                <button class="theme-toggle" id="themeToggle">üåô</button>
            </div>
        </header>

        <!-- Content -->
        <main class="content">
            <!-- IoT Station Configuration -->
            <section class="section">
                <h2 class="section-title">C·∫•u h√¨nh tr·∫°m IoT</h2>
                <div class="card">
                    <form id="iotConfigForm" onsubmit="saveIoTConfig(event)">
                        <div class="form-group">
                            <label class="form-label">T√™n tr·∫°m</label>
                            <input type="text" class="form-input" id="stationName"
                                value="Tr·∫°m t·∫ßm C√¥ng ngh·ªá cao, Qu·∫≠n 9">
                        </div>

                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ID Node 1</label>
                                <input type="text" class="form-input" id="node1Id" value="NODE_001">
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ID Node 2</label>
                                <input type="text" class="form-input" id="node2Id" value="NODE_002">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Chu k·ª≥ g·ª≠i d·ªØ li·ªáu (gi√¢y)</label>
                            <input type="number" class="form-input" id="dataInterval" value="60" min="10" max="3600">
                        </div>

                        <h3 class="section-subtitle mt-20">Ng∆∞·ª°ng c·∫£nh b√°o</h3>

                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">Nhi·ªát ƒë·ªô t·ªëi ƒëa (¬∞C)</label>
                                <input type="number" class="form-input" id="maxTemp" value="40" step="0.1">
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">ƒê·ªô ·∫©m t·ªëi ƒëa (%)</label>
                                <input type="number" class="form-input" id="maxHumidity" value="90">
                            </div>
                        </div>

                        <div class="filter-row">
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">CO‚ÇÇ t·ªëi ƒëa (ppm)</label>
                                <input type="number" class="form-input" id="maxCO2" value="1000">
                            </div>
                            <div class="form-group" style="flex: 1; margin-bottom: 0;">
                                <label class="form-label">B·ª•i m·ªãn t·ªëi ƒëa (¬µg/m¬≥)</label>
                                <input type="number" class="form-input" id="maxDust" value="50" step="0.1">
                            </div>
                        </div>

                        <div class="form-checkbox mt-10">
                            <input type="checkbox" id="enableAlerts" checked>
                            <label for="enableAlerts">G·ª≠i c·∫£nh b√°o khi v∆∞·ª£t ng∆∞·ª°ng</label>
                        </div>

                        <div class="mt-20">
                            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh IoT</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- Weather API Configuration -->
            <section class="section">
                <h2 class="section-title">C·∫•u h√¨nh API Th·ªùi ti·∫øt</h2>
                <div class="card">
                    <form id="apiConfigForm" onsubmit="saveAPIConfig(event)">
                        <div class="form-group">
                            <label class="form-label">API Key (OpenWeatherMap)</label>
                            <input type="password" class="form-input" id="apiKey" value="your_api_key_here"
                                placeholder="Nh·∫≠p API key...">
                        </div>

                        <div class="form-group">
                            <label class="form-label">Th√†nh ph·ªë ho·∫∑c t·ªça ƒë·ªô</label>
                            <input type="text" class="form-input" id="location" value="Ho Chi Minh City, VN">
                            <small style="color: var(--text-secondary); font-size: 12px;">
                                V√≠ d·ª•: "Hanoi, VN" ho·∫∑c "lat=10.8231&lon=106.6297"
                            </small>
                        </div>

                        <div class="mt-20">
                            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh API</button>
                            <button type="button" class="btn btn-secondary" onclick="testAPIConnection()">
                                üîå Ki·ªÉm tra k·∫øt n·ªëi API
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- ML Configuration -->
            <section class="section">
                <h2 class="section-title">C·∫•u h√¨nh ML</h2>
                <div class="card">
                    <form id="mlConfigForm" onsubmit="saveMLConfig(event)">
                        <div class="form-group">
                            <label class="form-label">Model d·ª± b√°o</label>
                            <select class="form-select" id="mlModel">
                                <option value="prophet" selected>Prophet (Facebook)</option>
                                <option value="lstm">LSTM (Deep Learning)</option>
                                <option value="arima">ARIMA</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">L·ªãch train l·∫°i t·ª± ƒë·ªông</label>
                            <select class="form-select" id="trainSchedule">
                                <option value="6">M·ªói 6 gi·ªù</option>
                                <option value="12" selected>M·ªói 12 gi·ªù</option>
                                <option value="24">M·ªói 24 gi·ªù</option>
                                <option value="0">Kh√¥ng t·ª± ƒë·ªông</option>
                            </select>
                        </div>

                        <div class="info-panel mt-10">
                            <div class="info-panel-content">
                                <strong>L∆∞u √Ω:</strong> Model s·∫Ω ƒë∆∞·ª£c train l·∫°i t·ª± ƒë·ªông d·ª±a tr√™n d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´
                                MySQL. Qu√° tr√¨nh train c√≥ th·ªÉ m·∫•t v√†i ph√∫t.
                            </div>
                        </div>

                        <div class="mt-20">
                            <button type="submit" class="btn btn-primary">üíæ L∆∞u c·∫•u h√¨nh ML</button>
                            <button type="button" class="btn btn-secondary" onclick="manualTrain()">
                                ü§ñ Gi·∫£ l·∫≠p Train model ngay
                            </button>
                        </div>

                        <div id="mlTrainingProgress" class="hidden mt-20">
                            <div class="progress-bar">
                                <div class="progress-fill" id="mlProgressFill" style="width: 0%;"></div>
                            </div>
                            <p style="text-align: center; margin-top: 10px; font-size: 14px;" id="mlTrainingStatus">ƒêang
                                train model...</p>
                        </div>
                    </form>
                </div>
            </section>

            <!-- UI Preferences -->
            <section class="section">
                <h2 class="section-title">Giao di·ªán & h·ªá th·ªëng</h2>
                <div class="card">
                    <div class="form-group">
                        <label class="form-label">Giao di·ªán</label>
                        <div class="form-checkbox">
                            <input type="checkbox" id="darkModeToggle">
                            <label for="darkModeToggle">Ch·∫ø ƒë·ªô t·ªëi (Dark Mode)</label>
                        </div>
                        <div class="form-checkbox">
                            <input type="checkbox" id="sidebarToggle" checked>
                            <label for="sidebarToggle">Hi·ªÉn th·ªã sidebar m·∫∑c ƒë·ªãnh</label>
                        </div>
                    </div>

                    <h3 class="section-subtitle mt-20">Th√¥ng tin Raspberry Pi</h3>
                    <div class="info-panel">
                        <div class="info-panel-content">
                            <div style="margin-bottom: 8px;">
                                <strong>Local IP:</strong> 192.168.1.100
                            </div>
                            <div style="margin-bottom: 8px;">
                                <strong>Tr·∫°ng th√°i server:</strong> <span style="color: var(--accent);">‚úì ƒêang
                                    ch·∫°y</span>
                            </div>
                            <div>
                                <strong>H·ªá ƒëi·ªÅu h√†nh:</strong> Raspberry Pi OS (Debian)
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script>
        // Save IoT Configuration
        function saveIoTConfig(event) {
            event.preventDefault();

            const config = {
                stationName: document.getElementById('stationName').value,
                node1Id: document.getElementById('node1Id').value,
                node2Id: document.getElementById('node2Id').value,
                dataInterval: document.getElementById('dataInterval').value,
                maxTemp: document.getElementById('maxTemp').value,
                maxHumidity: document.getElementById('maxHumidity').value,
                maxCO2: document.getElementById('maxCO2').value,
                maxDust: document.getElementById('maxDust').value,
                enableAlerts: document.getElementById('enableAlerts').checked,
            };

            console.log('IoT Config:', config);
            AppUtils.showToast('ƒê√£ l∆∞u c·∫•u h√¨nh tr·∫°m IoT th√†nh c√¥ng', 'success');
        }

        // Save API Configuration
        function saveAPIConfig(event) {
            event.preventDefault();

            const config = {
                apiKey: document.getElementById('apiKey').value,
                location: document.getElementById('location').value,
            };

            console.log('API Config:', config);
            AppUtils.showToast('ƒê√£ l∆∞u c·∫•u h√¨nh API th√†nh c√¥ng', 'success');
        }

        // Test API Connection
        async function testAPIConnection() {
            const btn = event.target;
            btn.disabled = true;
            btn.innerHTML = '<div class="loading"></div> ƒêang ki·ªÉm tra...';

            await new Promise(resolve => setTimeout(resolve, 1500));

            btn.disabled = false;
            btn.innerHTML = 'üîå Ki·ªÉm tra k·∫øt n·ªëi API';
            AppUtils.showToast('K·∫øt n·ªëi API th√†nh c√¥ng (gi·∫£ l·∫≠p)', 'success');
        }

        // Save ML Configuration
        function saveMLConfig(event) {
            event.preventDefault();

            const config = {
                mlModel: document.getElementById('mlModel').value,
                trainSchedule: document.getElementById('trainSchedule').value,
            };

            console.log('ML Config:', config);
            AppUtils.showToast('ƒê√£ l∆∞u c·∫•u h√¨nh ML th√†nh c√¥ng', 'success');
        }

        // Manual Train
        async function manualTrain() {
            const progressDiv = document.getElementById('mlTrainingProgress');
            const progressFill = document.getElementById('mlProgressFill');
            const statusText = document.getElementById('mlTrainingStatus');

            progressDiv.classList.remove('hidden');
            progressFill.style.width = '0%';
            statusText.textContent = 'ƒêang chu·∫©n b·ªã d·ªØ li·ªáu...';

            const steps = [
                { progress: 20, text: 'ƒêang t·∫£i d·ªØ li·ªáu t·ª´ MySQL...' },
                { progress: 40, text: 'ƒêang ti·ªÅn x·ª≠ l√Ω d·ªØ li·ªáu...' },
                { progress: 60, text: 'ƒêang train model...' },
                { progress: 80, text: 'ƒêang ƒë√°nh gi√° model...' },
                { progress: 100, text: 'Ho√†n th√†nh!' }
            ];

            for (const step of steps) {
                await new Promise(resolve => setTimeout(resolve, 800));
                progressFill.style.width = step.progress + '%';
                statusText.textContent = step.text;
            }

            setTimeout(() => {
                progressDiv.classList.add('hidden');
                AppUtils.showToast('Train model th√†nh c√¥ng! (gi·∫£ l·∫≠p)', 'success');
            }, 1000);
        }

        // Sync UI preferences with current state
        function syncUIPreferences() {
            const isDark = document.body.classList.contains('dark-mode');
            document.getElementById('darkModeToggle').checked = isDark;

            const sidebarOpen = !document.getElementById('sidebar').classList.contains('collapsed');
            document.getElementById('sidebarToggle').checked = sidebarOpen;

            // Listen for changes
            document.getElementById('darkModeToggle').addEventListener('change', (e) => {
                if (e.target.checked !== isDark) {
                    document.getElementById('themeToggle').click();
                }
            });

            document.getElementById('sidebarToggle').addEventListener('change', (e) => {
                localStorage.setItem('sidebarOpen', e.target.checked);
                AppUtils.showToast('C√†i ƒë·∫∑t sidebar s·∫Ω √°p d·ª•ng khi t·∫£i l·∫°i trang', 'success');
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', () => {
            syncUIPreferences();
        });
    </script>
</body>

</html>